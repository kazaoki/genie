#!/usr/bin/env node
parcelRequire=function(e,r,n,t){var i="function"==typeof parcelRequire&&parcelRequire,o="function"==typeof require&&require;function u(n,t){if(!r[n]){if(!e[n]){var f="function"==typeof parcelRequire&&parcelRequire;if(!t&&f)return f(n,!0);if(i)return i(n,!0);if(o&&"string"==typeof n)return o(n);var c=new Error("Cannot find module '"+n+"'");throw c.code="MODULE_NOT_FOUND",c}p.resolve=function(r){return e[n][1][r]||r};var l=r[n]=new u.Module(n);e[n][0].call(l.exports,p,l,l.exports,this)}return r[n].exports;function p(e){return u(p.resolve(e))}}u.isParcelRequire=!0,u.Module=function(e){this.id=e,this.bundle=u,this.exports={}},u.modules=e,u.cache=r,u.parent=i,u.register=function(r,n){e[r]=[function(e,r){r.exports=n},{}]};for(var f=0;f<n.length;f++)u(n[f]);if(n.length){var c=u(n[n.length-1]);"object"==typeof exports&&"undefined"!=typeof module?module.exports=c:"function"==typeof define&&define.amd?define(function(){return c}):t&&(this[t]=c)}return u}({3:[function(require,module,exports) {
"use strict";function _asyncToGenerator(e){return function(){var r=e.apply(this,arguments);return new Promise(function(e,o){return function t(n,s){try{var l=r[n](s),a=l.value}catch(e){return void o(e)}if(!l.done)return Promise.resolve(a).then(function(e){t("next",e)},function(e){t("throw",e)});e(a)}("next")})}}const fs=require("fs"),strwidth=require("string-width"),color=require("cli-color"),wrap=require("jp-wrap")(color.windowSize.width-8),child=require("child_process"),path=require("path"),util=require("util"),d=module.exports.d=(e=>console.log(util.inspect(e,{colors:!0,compact:!1,breakLength:10,depth:10}))),h=module.exports.h=((e,r=color.white)=>console.log("\n  "+r(e))),getRootDir=module.exports.getRootDir=(()=>{let e="",r=process.cwd(),o=!0;do{try{fs.accessSync(r+"/.genie"),e=r}catch(e){r===(r=path.dirname(r))&&(o=!1)}}while(""===e&&o);if(e)return e;Error("先祖ディレクトリに .genie/ が見つかりませんでした。\n`genie init` などして初期化してください。")}),Repeat=module.exports.Repeat=((e,r=1)=>{if(!r>0)return"";let o="";for(let t=0;t<r;t++)o+=e;return o}),Message=module.exports.Message=((e,r="default",o=0)=>{let t=color.white,n=color.white;"primary"===r?(t=color.xterm(26),n=color.xterm(39)):"success"===r?(t=color.green,n=color.greenBright):"danger"===r?(t=color.red,n=color.redBright):"warning"===r?(t=color.yellow,n=color.yellowBright):"info"===r?(t=color.whiteBright,n=color.whiteBright):"whisper"===r&&(t=color.blackBright,n=color.blackBright);let s=(e=wrap(e.replace(/[\r\n]+$/,""))).split(/[\r\n]+/),l=0;for(let e in s){let r=strwidth(s[e]);l<r&&(l=r)}l+=2,console.log("  "+t("┏")+t(Repeat("─",l))+t("┓"));for(let e in s)o>0&&o==e&&console.log("  "+t("┣")+t(Repeat("─",l))+t("┫")),console.log("  "+t("│")+n(" "+s[e]+" ")+Repeat(" ",l-2-strwidth(s[e]))+t("│"));console.log("  "+t("┗")+t(Repeat("─",l))+t("┛"))}),Messages=module.exports.Messages=(e=>{Array.isArray(e)||(e=[e]);for(let r in e)for(let o in e[r])Message(e[r][o],o)}),Input=module.exports.Input=((e,r=20)=>{const o=require("readline").createInterface(process.stdin,process.stdout);let t=color.bgBlack("  "),n=strwidth(e="  "+e+"  ")+r,s=color.whiteBright.bgBlueBright,l=color.bgBlue;return process.stdout.write("\n"+t+s(Repeat(" ",n))+"\n"+t+s(e+Repeat(" ",r))+"\n"+t+s(Repeat(" ",n))+"\n"+t+l(Repeat(" ",n))+"\n"),process.stdout.write(color.move.up(3)),process.stdout.write(color.move.right(n-r)),new Promise(e=>{o.on("line",r=>{process.stdout.write(color.move.down(3)),o.close(),e(r)})})}),Say=module.exports.Say=(e=>{if(0!==e.length)if(isMac())child.execSync(`say -r 300 "${e}"`);else if(isWindows()){let r=fs.mkdtempSync(process.env.TEMP+"/genie-say-"),o=r+"/say.js";fs.writeFileSync(o,"var args = [];for(var i = 0; i < WScript.Arguments.length; i++) args.push(WScript.Arguments.Item(i));WScript.CreateObject('SAPI.SpVoice').Speak('<volume level=\"100\">'+'<rate speed=\"2\">'+'<pitch middle=\"0\">'+args.join(' ')+'</pitch>'+'</rate>'+'</volume>', 8);"),child.execSync(`start wscript ${o} "${e}"`),fs.unlinkSync(o),fs.rmdirSync(r)}}),showRunmode=module.exports.showRunmode=(e=>{console.log(color.blackBright(`<${process.env.GENIE_RUNMODE}>`))}),loadConfig=module.exports.loadConfig=(argv=>{let root_dir=getRootDir(),config_js=path.join(root_dir,".genie",argv.config);try{fs.accessSync(config_js)}catch(e){Error(`設定ファイル（.genie/${argv.config}）が見つかりませんでした。`)}try{delete require.cache[require.resolve(config_js)]}catch(e){}let config=require(config_js).config;if(config.runmode=argv.mode,config.root=root_dir,"test"===config.runmode){if(config.core.docker.name+="-TEST",config.core.docker.mount_mode="copy",config.core.docker.down_with_volumes=!0,config.core.memo=void 0,config.lang.php.error_report=!1,config.log.fluentd=void 0,config.http.browser.at_upped=void 0,config.http.apache.external_http_port="auto",config.http.apache.external_https_port="auto",config.mail.postfix.enabled=!1,config.mail.maildev.external_port=void 0,config.db.mysql){var _iteratorNormalCompletion=!0,_didIteratorError=!1,_iteratorError=void 0;try{for(var _iterator=Object.keys(config.db.mysql)[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=!0){let e=_step.value;config.db.mysql[e].external_port=void 0}}catch(e){_didIteratorError=!0,_iteratorError=e}finally{try{!_iteratorNormalCompletion&&_iterator.return&&_iterator.return()}finally{if(_didIteratorError)throw _iteratorError}}}if(config.db.postgresql){var _iteratorNormalCompletion2=!0,_didIteratorError2=!1,_iteratorError2=void 0;try{for(var _iterator2=Object.keys(config.db.postgresql)[Symbol.iterator](),_step2;!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=!0){let e=_step2.value;config.db.postgresql[e].external_port=void 0}}catch(e){_didIteratorError2=!0,_iteratorError2=e}finally{try{!_iteratorNormalCompletion2&&_iterator2.return&&_iterator2.return()}finally{if(_didIteratorError2)throw _iteratorError2}}}}let paths=path.parse(config_js),add_config_js;add_config_js=path.isAbsolute(config_js)?`${paths.dir}/${paths.name}-${config.runmode}${paths.ext}`:`${root_dir}/.genie/${paths.dir}/${paths.name}-${config.runmode}${paths.ext}`;try{fs.accessSync(add_config_js),eval(fs.readFileSync(add_config_js).toString())}catch(e){}if(config.base_name=config.core.docker.name,!config.core.docker.machine&&process.env.DOCKER_MACHINE_NAME&&(config.core.docker.machine=process.env.DOCKER_MACHINE_NAME),config.core.docker.ip_force)config.host_ip=config.core.docker.ip_force;else if(hasDockerMachineEnv()&&config.core.docker.machine){let e=child.spawnSync("docker-machine",["ip",config.core.docker.machine]);e.status&&Error(e.stderr.toString()),config.host_ip=e.stdout.toString().trim()}else config.host_ip="localhost";return config}),isWindows=module.exports.isWindows=(()=>"win32"===process.platform),isMac=module.exports.isMac=(()=>"darwin"===process.platform),hasDockerMachineEnv=module.exports.hasDockerMachineEnv=(()=>{return 0===child.spawnSync("docker-machine").status}),Error=module.exports.Error=(e=>{console.log(),Message(`エラーが発生しました。\n${e}`,"danger",1),Say("エラーが発生しました"),process.exit()}),dockerDown=module.exports.dockerDown=((e,r)=>new Promise((o,t)=>{let n=existContainers(e);n||o();let s=[];var l=!0,a=!1,i=void 0;try{for(var c,p=n[Symbol.iterator]();!(l=(c=p.next()).done);l=!0){let e=c.value;s.push(new Promise((r,o)=>{child.spawn("docker",["rm","-f","-v",e.id]).stderr.on("data",r=>{console.log(color.blackBright(`  [Container] ${e.name} (${e.id}) ... `)+color.red("delete NG!")),o(r)}).on("close",o=>{console.log(color.blackBright(`  [Container] ${e.name} (${e.id}) ... `)+color.green("deleted")),r()})}))}}catch(e){a=!0,i=e}finally{try{!l&&p.return&&p.return()}finally{if(a)throw i}}Promise.all(s).catch(e=>{Error(e)}).then(()=>{if(e.core.docker.down_with_volumes||r){let r=[],i=new RegExp(`^(locked_)?${e.base_name}`),c=child.spawnSync("docker",["volume","ls","--format","{{.Name}}"]);c.status&&Error(c.stderr.toString());var t=!0,n=!1,s=void 0;try{for(var l,a=c.stdout.toString().trim().split(/\n/)[Symbol.iterator]();!(t=(l=a.next()).done);t=!0){let e=l.value;e.match(i)&&r.push(new Promise((r,o)=>{child.spawn("docker",["volume","rm","-f",e]).stderr.on("data",r=>{console.log(color.blackBright(`  [Volume] ${e} ... `)+color.red("delete NG!")),o(r)}).on("close",o=>{console.log(color.blackBright(`  [Volume] ${e} ... `)+color.green("deleted")),r()})}))}}catch(e){n=!0,s=e}finally{try{!t&&a.return&&a.return()}finally{if(n)throw s}}Promise.all(r).catch(e=>{Error(e)}).then(()=>{o()})}else o()})})),dockerUpMySQL=module.exports.dockerUpMySQL=((e,r)=>new Promise((o,t)=>{let n=r.db.mysql[e],s=`${r.base_name}-mysql-${e}`,l=[];l.push("run","-d","-it"),l.push("-e","TERM=xterm-256color"),l.push("--name",s),l.push("--label",`genie_runmode="${r.runmode}"`),l.push("--label",`genie_root="${r.root}"`),l.push("-v",`${r.root}/.genie/files/opt/mysql/:/opt/mysql/`),l.push("-v",`${n.volume_lock?"locked_":""}${s}:/var/lib/mysql`),l.push("-e",`MYSQL_LABEL=${e}`),l.push("-e",`MYSQL_ROOT_PASSWORD=${n.pass}`),l.push("-e",`MYSQL_DATABASE=${n.name}`),l.push("-e",`MYSQL_USER=${n.user}`),l.push("-e",`MYSQL_PASSWORD=${n.pass}`),l.push("-e",`MYSQL_CHARSET=${n.charset}`),r.core.docker.network&&l.push(`--net=${r.core.docker.network}`),r.core.docker.options&&l.push(`${r.core.docker.options}`),n.external_port&&l.push("-p","auto"===n.external_port?"3306":`${n.external_port}:3306`),l.push("--entrypoint=/opt/mysql/before-entrypoint.sh"),l.push("--restart=always"),l.push(n.repository),l.push("mysqld"),n.charset&&l.push(`--character-set-server=${n.charset}`),n.collation&&l.push(`--collation-server=${n.collation}`),child.spawn("docker",l).stderr.on("data",e=>{e.toString().match(/Unable to find image '.+' locally/)&&(process.env[`DOCKER_IMAGE_DOWN_LOADING_${s.toUpperCase()}`]=!0)}).on("close",e=>{delete process.env[`DOCKER_IMAGE_DOWN_LOADING_${s.toUpperCase()}`],child.exec(`docker exec ${s} sh -c "echo 'docker ${l.join(" ")}' > /docker-run.cmd"`),o()})})),dockerUpPostgreSQL=module.exports.dockerUpPostgreSQL=((e,r)=>new Promise((o,t)=>{let n=r.db.postgresql[e],s=`${r.base_name}-postgresql-${e}`,l=[];l.push("run","-d","-it"),l.push("-e","TERM=xterm-256color"),l.push("-e","LC_ALL=C"),l.push("--name",s),l.push("--label",`genie_runmode="${r.runmode}"`),l.push("--label",`genie_root="${r.root}"`),l.push("-v",`${r.root}/.genie/files/opt/postgresql/:/opt/postgresql/`),l.push("-v",`${n.volume_lock?"locked_":""}${s}:/var/lib/postgresql/data`),l.push("-e",`POSTGRES_LABEL=${e}`),l.push("-e",`POSTGRES_HOST=${n.host}`),l.push("-e",`POSTGRES_DB=${n.name}`),l.push("-e",`POSTGRES_USER=${n.user}`),l.push("-e",`POSTGRES_PASSWORD=${n.pass}`),l.push("-e",`POSTGERS_ENCODING=${n.encoding}`),l.push("-e",`POSTGERS_LOCALE=${n.locale}`),r.core.docker.network&&l.push(`--net=${r.core.docker.network}`),r.core.docker.options&&l.push(`${r.core.docker.options}`),n.external_port&&l.push("-p","auto"===n.external_port?"5432":`${n.external_port}:5432`),l.push("--entrypoint=/opt/postgresql/before-entrypoint.sh"),l.push("--restart=always"),l.push(n.repository),l.push("postgres"),child.spawn("docker",l).stderr.on("data",e=>{e.toString().match(/Unable to find image '.+' locally/)&&(process.env[`DOCKER_IMAGE_DOWN_LOADING_${s.toUpperCase()}`]=!0)}).on("close",e=>{delete process.env[`DOCKER_IMAGE_DOWN_LOADING_${s.toUpperCase()}`],child.exec(`docker exec ${s} sh -c "echo 'docker ${l.join(" ")}' > /docker-run.cmd"`),o()})})),dockerUp=module.exports.dockerUp=(e=>new Promise((r,o)=>{let t=[];if(t.push("run","-d","-it"),t.push("-e","TERM=xterm-256color"),t.push("-e","LANG=ja_JP.UTF-8"),t.push("-e","LC_ALL=ja_JP.UTF-8"),t.push("-v",e.root+"/.genie/files/opt:/opt"),t.push("--label",`genie_runmode="${e.runmode}"`),t.push("--label",`genie_root="${e.root}"`),t.push(`--name=${e.base_name}`),e.core.docker.network&&t.push(`--net=${e.core.docker.network}`),e.core.docker.options&&t.push(`${e.core.docker.options}`),t.push("--restart=always"),e.db.postgresql){let r=Object.keys(e.db.postgresql);for(let o=0;o<r.length;o++){let n=`${e.base_name}-postgresql-${r[o]}`;t.push("--link",n),t.push("--add-host",e.db.postgresql[r[o]].host+":"+getContainerIp(n,e))}}if(e.db.mysql){let r=Object.keys(e.db.mysql);for(let o=0;o<r.length;o++){let n=`${e.base_name}-mysql-${r[o]}`;t.push("--link",n),t.push("--add-host",e.db.mysql[r[o]].host+":"+getContainerIp(n,e))}}if(e.lang.php.phpenv_image){let r=e.lang.php.phpenv_container_name;t.push("--volumes-from",r)}if(e.trans.sshd&&e.trans.sshd.enabled&&(e.trans.sshd.external_port?t.push("-p","auto"===e.trans.sshd.external_port?"22":`${e.trans.sshd.external_port}:22`):t.push("--expose",22)),e.http.apache&&e.http.apache.enabled&&(t.push("-v",`${e.root}/${e.http.apache.public_dir}:/var/www/html`),e.http.apache.external_http_port?t.push("-p","auto"===e.http.apache.external_http_port?"80":`${e.http.apache.external_http_port}:80`):t.push("--expose",80),e.http.apache.external_https_port?t.push("-p","auto"===e.http.apache.external_https_port?"443":`${e.http.apache.external_https_port}:443`):t.push("--expose",443)),e.http.nginx&&e.http.nginx.enabled&&(t.push("-v",`${e.root}/${e.http.nginx.public_dir}:/usr/share/nginx/html`),e.http.nginx.external_http_port?t.push("-p","auto"===e.http.nginx.external_http_port?"80":`${e.http.nginx.external_http_port}:80`):t.push("--expose",80),e.http.nginx.external_https_port?t.push("-p","auto"===e.http.nginx.external_https_port?"443":`${e.http.nginx.external_https_port}:443`):t.push("--expose",443)),e.mail.maildev&&e.mail.maildev.enabled&&(e.mail.maildev.external_port?t.push("-p","auto"===e.mail.maildev.external_port?"9981":`${e.mail.maildev.external_port}:9981`):t.push("--expose",9981)),e.log.fluentd&&t.push("-v",`${e.root}/.genie/files/opt/td-agent:/etc/td-agent`),e.core.docker.hosts&&Array.isArray(e.core.docker.hosts)&&e.core.docker.hosts.length)for(let r=0;r<e.core.docker.hosts.length;r++)t.push(`--add-host=${e.core.docker.hosts[r]}`);if(e.core.docker.mounts&&Array.isArray(e.core.docker.mounts)&&e.core.docker.mounts.length)for(let r=0;r<e.core.docker.mounts.length;r++)e.core.docker.mounts[r].match(/^\//)?t.push("-v",`${e.core.docker.mounts[r]}`):t.push("-v",`${e.root}/${e.core.docker.mounts[r]}`);if("copy"===e.core.docker.mount_mode)for(let e=0;e<t.length;e++)"-v"===t[e]&&(t[e+1]=t[e+1].replace(/(.+\:)([^\:]+)(\:?([^\:]+))?$/g,"$1/_$2:ro"),e++);t.push("-v",e.root+"/.genie:/genie");let n=data2envs(e,"GENIE");n.GENIE_RUNMODE=e.runmode;let s=Object.keys(n);for(let e=0;e<s.length;e++)t.push("-e",`${s[e]}=${n[s[e]]}`);t.push(e.core.docker.image);let l=child.spawnSync("docker",t);if(l.status)o(l.stderr.toString());else{let o=child.spawnSync("docker",["inspect",'--format="{{.NetworkSettings.Ports}}"',e.base_name]).stdout.toString();if(o&&o.trim().length>7){let e=o.match(/\d+\/\w+\:\[\{[\d\.]+ \d+\}\]/g);if(e){var a=!0,i=!1,c=void 0;try{for(var p,d=e[Symbol.iterator]();!(a=(p=d.next()).done);a=!0){let e=p.value.match(/(\d+)\/\w+\:\[\{[\d\.]+ (\d+)\}\]/);process.env["GENIE_PORT"+e[1]]=e[2]}}catch(e){i=!0,c=e}finally{try{!a&&d.return&&d.return()}finally{if(i)throw c}}}}process.env.GENIE_HOST_IP=e.host_ip,r()}})),dockerUpPhpEnv=module.exports.dockerUpPhpEnv=(e=>new Promise((r,o)=>{let t=e.lang.php.phpenv_image.match(/\:([\.\d]+)$/)[1],n=`${e.base_name}-phpenv-${t}`;e.lang.php.phpenv_version=t,e.lang.php.phpenv_container_name=n;let s=[];s.push("run"),s.push("--name",n),s.push("--label",`genie_runmode="${e.runmode}"`),s.push("--label",`genie_root="${e.root}"`),s.push("--label",'genie_anyenv="phpenv"'),s.push(e.lang.php.phpenv_image),child.spawn("docker",s).stderr.on("data",e=>{e.toString().match(/Unable to find image '.+' locally/)&&(process.env[`DOCKER_IMAGE_DOWN_LOADING_${n.toUpperCase()}`]=!0)}).on("close",e=>{delete process.env[`DOCKER_IMAGE_DOWN_LOADING_${n.toUpperCase()}`],r()})})),existContainers=module.exports.existContainers=((e,r)=>{let o=["--filter",`label=genie_root="${e.root}"`,"--filter",`label=genie_runmode="${e.runmode}"`];r&&o.push("--filter",`name=${r}`);let t=child.spawnSync("docker",["ps","-a","--format","{{.ID}}\t{{.Names}}",...o]);t.status&&Error(t.stderr.toString());let n=[];var s=!0,l=!1,a=void 0;try{for(var i,c=t.stdout.toString().split(/\n/)[Symbol.iterator]();!(s=(i=c.next()).done);s=!0){let e=i.value.split(/\t+/);e[0]&&n.push({id:e[0],name:e[1]})}}catch(e){l=!0,a=e}finally{try{!s&&c.return&&c.return()}finally{if(l)throw a}}return!!n.length&&n}),getContainerIp=module.exports.getContainerIp=((e,r)=>{try{let o;if(!(o=r.core.docker.network?child.spawnSync("docker",["inspect",`--format={{.NetworkSettings.Networks.${r.core.docker.network}.IPAddress}}`,e]):child.spawnSync("docker",["inspect","--format={{.NetworkSettings.IPAddress}}",e])).stderr.toString())return o.stdout.toString().replace(/[\r\n]$/,"");Error(o.stderr.toString())}catch(e){Error(e)}}),sleep=module.exports.sleep=(e=>new Promise(r=>setTimeout(r,e))),data2envs=module.exports.data2envs=((e,r)=>{let o={},t=(e,r)=>{if(e&&"object"==typeof e&&!Array.isArray(e)){let o=Object.keys(e);for(let n=0;n<o.length;n++)t(e[o[n]],`${r}_${o[n].toUpperCase()}`)}else"object"==typeof e&&Array.isArray(e)?o[r]=JSON.stringify(e):o[r]=e};return t(e,r),o}),para_progress=module.exports.para_progress=(e=>new Promise((()=>{var r=_asyncToGenerator(function*(r,o){console.log();let t=0;for(let r in e)e[r].status=null,e[r].func.then(function(){e[r].status=!0}).catch(function(o){e[r].status=!1,e[r].error=o}).then(function(){t++});let n=0;do{yield sleep(100),n++&&process.stdout.write(color.move.up(e.length));var s=!0,l=!1,a=void 0;try{for(var i,c=e[Symbol.iterator]();!(s=(i=c.next()).done);s=!0){let e=i.value;process.stdout.write(color.erase.line);let r=null===e.status?color.yellow(e.proc?e.proc:"running"):e.status?color.green(e.ok?e.ok:"ready!"):color.red(e.ng?e.ng:"error! "+e.error);console.log(`  ${e.label} ... ${r}`)}}catch(e){l=!0,a=e}finally{try{!s&&c.return&&c.return()}finally{if(l)throw a}}}while(t!==e.length);r()});return function(e,o){return r.apply(this,arguments)}})())),get_external_port=module.exports.get_external_port=((e,r)=>{let o=child.spawnSync("docker",["port",e.base_name,r]);if(o.status)return!1;let t=o.stdout.toString().trim().match(/(\d+)$/);return!!t[1]&&t[1]});
},{}],5:[function(require,module,exports) {
"use strict";function e(e){return function(){var n=e.apply(this,arguments);return new Promise(function(e,t){return function r(s,o){try{var a=n[s](o),i=a.value}catch(e){return void t(e)}if(!a.done)return Promise.resolve(i).then(function(e){r("next",e)},function(e){r("throw",e)});e(i)}("next")})}}const n=require("./libs.js");module.exports=(()=>{var t=e(function*(e){console.log(),n.Message("サンプル：default","default"),n.Message("サンプル：primary","primary"),n.Message("サンプル：success","success"),n.Message("サンプル：danger","danger"),n.Message("サンプル：warning","warning"),n.Message("サンプル：info","info"),n.Message("改行込み、1ライン入れも可能。\ntest1\ntest2\ntest3","default",1);let t=yield n.Input("入力BOX（入力文字を発音しますのでご注意）：",20);n.Message("入力された文字："+t),n.Say(t);try{throw new Error("エラーテスト（終了コード255）")}catch(e){console.log(e),process.exit(255)}});return function(e){return t.apply(this,arguments)}})();
},{"./libs.js":3}],7:[function(require,module,exports) {
"use strict";function e(e){return function(){var n=e.apply(this,arguments);return new Promise(function(e,r){return function t(i,c){try{var o=n[i](c),s=o.value}catch(e){return void r(e)}if(!o.done)return Promise.resolve(s).then(function(e){t("next",e)},function(e){t("throw",e)});e(s)}("next")})}}const n=require("./libs.js"),r=require("path"),t=require("fs-extra");module.exports=(()=>{var i=e(function*(e){if(e.usage("Usage: genie|g init").argv.help)return console.log(),n.Message(e.help(),"primary",1);let i=r.join(__dirname,"../.genie"),c=r.join(process.cwd(),".genie");try{t.accessSync(i)}catch(e){n.Error(`初期化元になる .genie/ ディレクトリが見つかりません。 genic-cmd 自体を再インストールしてください。\n${i}`)}try{t.accessSync(c),n.Error(`このディレクトリには既に .genie/ が存在しています。\n${c}`)}catch(e){}t.copySync(i,c)});return function(e){return i.apply(this,arguments)}})();
},{"./libs.js":3}],9:[function(require,module,exports) {
"use strict";function e(e){return function(){var n=e.apply(this,arguments);return new Promise(function(e,r){return function t(i,o){try{var s=n[i](o),u=s.value}catch(e){return void r(e)}if(!s.done)return Promise.resolve(u).then(function(e){t("next",e)},function(e){t("throw",e)});e(u)}("next")})}}const n=require("./libs.js"),r=require("child_process");module.exports=(()=>{var t=e(function*(e){let t=e.usage("Usage: genie|g config [Options]").options("dump",{alias:"d",describe:"設定値を確認します。"}).argv;if(t.help)return console.log(),n.Message(e.help(),"primary",1);let i=n.loadConfig(t);if(t.dump)d(i);else{let e=`${n.getRootDir()}/.genie/${t.config}`;n.isWindows()?r.execSync(`start ${e}`):n.isMac()&&r.execSync(`open ${e}`)}});return function(e){return t.apply(this,arguments)}})();
},{"./libs.js":3}],11:[function(require,module,exports) {
"use strict";function e(e){return function(){var n=e.apply(this,arguments);return new Promise(function(e,t){return function o(i,r){try{var s=n[i](r),c=s.value}catch(e){return void t(e)}if(!s.done)return Promise.resolve(c).then(function(e){o("next",e)},function(e){o("throw",e)});e(c)}("next")})}}const n=require("./libs.js"),t=require("child_process"),o=require("cli-color"),i=require("cliui")({width:o.windowSize.width-4});module.exports=(()=>{var o=e(function*(e){n.showRunmode();let o=e.usage("Usage: genie|g ls [Options]").options("long",{alias:"l",describe:"コンテナ一覧がもうちょっとだけ詳細に出ます"}).argv;return o.help?(console.log(),n.Message(e.help(),"primary",1)):new Promise(function(e,r){let s=[],c={};s.push(new Promise(function(e,n){t.execFile("docker-machine",["ls"],function(n,t,o){c.DockeMachines=t,e()})})),s.push(new Promise(function(e,n){t.execFile("docker",["images"],function(t,o,i){t&&n(),c.Images=o,e()})})),s.push(new Promise(function(e,n){t.execFile("docker",["volume","ls","--format","table {{.Name}}\t{{.Driver}}\t{{.Scope}}"],function(t,o,i){t&&n(),c.Volumes=o,e()})})),s.push(new Promise(function(e,n){let r=["--format","{{.Names}}\t{{.ID}}\t{{.Image}}\t{{.Status}}\t{{.Ports}}"],s=["NAMES","ID","IMAGE","STATUS","PORTS"];o.long&&(r=["--format","{{.Names}}\t{{.ID}}\t{{.Image}}\t{{.Command}}\t{{.CreatedAt}}\t{{.Status}}\t{{.Ports}}\t{{.Labels}}"],s=["NAMES","ID","IMAGE","COMMAND","CREATED","STATUS","PORTS","LABELS"]),t.execFile("docker",["ps","-a",...r],function(t,r,a){t&&n();let l=r.trim().split("\n");l.unshift(s.join("\t"));for(let e in l){let n=l[e].split(/\t/),t=[];for(let e in n){let i;o.long?(6==e&&(i=30),7==e&&(i=50)):4==e&&(i=30),t.push({text:n[e].replace(/, ?/g,"\n"),width:i,padding:[0,1,0,1]})}i.div(...t)}c.Containers=i.toString(),e()})})),Promise.all(s).then(function(){c.DockerMachines&&(console.log("\n  DockeMachines"),n.Message(c.DockeMachines,"primary",1)),console.log("\n  Images"),n.Message(c.Images,"primary",1),console.log("\n  Volumes"),n.Message(c.Volumes,"primary",1),console.log("\n  Containers"),n.Message(c.Containers,"primary",1),e()}).catch(function(e){return n.Error(e)})})});return function(e){return o.apply(this,arguments)}})();
},{"./libs.js":3}],13:[function(require,module,exports) {
"use strict";function e(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,r){return function n(o,s){try{var a=t[o](s),l=a.value}catch(e){return void r(e)}if(!a.done)return Promise.resolve(l).then(function(e){n("next",e)},function(e){n("throw",e)});e(l)}("next")})}}const t=require("./libs.js"),r=require("child_process"),n=require("cli-color"),o=require("fs");module.exports=(()=>{var s=e(function*(s){let a=s.usage("Usage: genie|g up [Options]").argv;if(a.help)return console.log(),t.Message(s.help(),"primary",1);let l=t.loadConfig(a);if(t.showRunmode(),l.core.memo)try{let e=l.core.memo.up;e&&t.Messages(e)}catch(e){Error("メモの設定が異常です。")}return new Promise((i=e(function*(e,a){let i=[];if(yield t.dockerDown(l),l.db.postgresql){o.chmodSync(`${l.root}/.genie/files/opt/postgresql/before-entrypoint.sh`,493);var p=!0,u=!1,c=void 0;try{for(var h,y=Object.keys(l.db.postgresql)[Symbol.iterator]();!(p=(h=y.next()).done);p=!0){let e=h.value;i.push(t.dockerUpPostgreSQL(e,l))}}catch(e){u=!0,c=e}finally{try{!p&&y.return&&y.return()}finally{if(u)throw c}}}if(l.db.mysql){o.chmodSync(`${l.root}/.genie/files/opt/mysql/before-entrypoint.sh`,493);var d=!0,g=!1,m=void 0;try{for(var f,$=Object.keys(l.db.mysql)[Symbol.iterator]();!(d=(f=$.next()).done);d=!0){let e=f.value;i.push(t.dockerUpMySQL(e,l))}}catch(e){g=!0,m=e}finally{try{!d&&$.return&&$.return()}finally{if(g)throw m}}}l.lang.php.phpenv_image&&i.push(t.dockerUpPhpEnv(l)),Promise.all(i).catch(function(e){t.Error(e)}).then(function(){return t.dockerUp(l).catch(function(e){return t.Error(e)})}),console.log();let b,v=0,w={};do{if(b=[],l.db.postgresql&&Object.keys(l.db.postgresql).length){var _=!0,q=!1,O=void 0;try{for(var S,k=Object.keys(l.db.postgresql)[Symbol.iterator]();!(_=(S=k.next()).done);_=!0){let e=S.value,t=`${l.base_name}-postgresql-${e}`;if(w[t])b.push(`  ${t} ... ${n.green("ready!")}`);else{"0"===r.spawnSync("docker",["exec",t,"sh","-c","ps aux|grep entrypoint.sh|grep -v grep|wc -l"]).stdout.toString().trim()?(w[t]=!0,b.push(`  ${t} ... ${n.green("ready!")}`)):process.env[`DOCKER_IMAGE_DOWN_LOADING_${t.toUpperCase()}`]?b.push(`  ${t} ... ${n.yellow("image downloading")}`):b.push(`  ${t} ... ${n.yellow("loading")}`)}}}catch(e){q=!0,O=e}finally{try{!_&&k.return&&k.return()}finally{if(q)throw O}}}if(l.db.mysql&&Object.keys(l.db.mysql).length){var x=!0,P=!1,D=void 0;try{for(var j,E=Object.keys(l.db.mysql)[Symbol.iterator]();!(x=(j=E.next()).done);x=!0){let e=j.value,t=`${l.base_name}-mysql-${e}`;if(w[t])b.push(`  ${t} ... ${n.green("ready!")}`);else{let e=r.spawnSync("docker",["logs",t]).stdout.toString();e.match(/Initializing database/)&&e.match(/MySQL init process done\. Ready for start up\./)||!e.match(/Initializing database/)&&e.match(/mysqld\: ready for connections\./)?(w[t]=!0,b.push(`  ${t} ... ${n.green("ready!")}`)):process.env[`DOCKER_IMAGE_DOWN_LOADING_${t.toUpperCase()}`]?b.push(`  ${t} ... ${n.yellow("image downloading")}`):b.push(`  ${t} ... ${n.yellow("loading")}`)}}}catch(e){P=!0,D=e}finally{try{!x&&E.return&&E.return()}finally{if(P)throw D}}}if(l.lang.php.phpenv_image){let e=l.lang.php.phpenv_container_name;if(w[e])b.push(`  ${e} ... ${n.green("ready!")}`);else{r.spawnSync("docker",["ps","-qa","--filter",`name=${e}`]).stdout.toString().trim().length?(w[e]=!0,b.push(`  ${e} ... ${n.green("ready!")}`)):process.env[`DOCKER_IMAGE_DOWN_LOADING_${e.toUpperCase()}`]?b.push(`  ${e} ... ${n.yellow("image downloading")}`):b.push(`  ${e} ... ${n.yellow("loading")}`)}}if(Object.keys(w).length!==b.length)b.push(`  ${l.base_name} ... ${n.yellow("waiting")}`);else{let e=r.spawnSync("docker",["exec",l.base_name,"cat","/var/log/entrypoint.log"]).stdout.toString();e.match(/entrypoint\.sh setup done\./)?(w[l.base_name]=!0,b.push(`  ${l.base_name} ... ${n.green("ready!")}`)):e.match(/init\.sh setup done\./)?b.push(`  ${l.base_name} ... ${n.yellow("init.sh setup")}`):e.match(/Postfix setup done\./)?b.push(`  ${l.base_name} ... ${n.yellow("Postfix setup")}`):e.match(/Nginx setup done\./)?b.push(`  ${l.base_name} ... ${n.yellow("Nginx setup")}`):e.match(/Apache setup done\./)?b.push(`  ${l.base_name} ... ${n.yellow("Apache setup")}`):e.match(/PHP setup done\./)?b.push(`  ${l.base_name} ... ${n.yellow("PHP setup")}`):e.match(/entrypoint\.sh setup start\./)?b.push(`  ${l.base_name} ... ${n.yellow("loading")}`):b.push(`  ${l.base_name} ... ${n.yellow("waiting")}`)}v++&&process.stdout.write(n.move.up(b.length));var A=!0,C=!1,I=void 0;try{for(var M,N=b[Symbol.iterator]();!(A=(M=N.next()).done);A=!0){let e=M.value;process.stdout.write(n.erase.line),console.log(e)}}catch(e){C=!0,I=e}finally{try{!A&&N.return&&N.return()}finally{if(C)throw I}}Object.keys(w).length!==b.length&&(yield t.sleep(100))}while(Object.keys(w).length!==b.length);l.http.browser.at_upped&&(yield CMDS.open(s)),e()}),function(e,t){return i.apply(this,arguments)}));var i});return function(e){return s.apply(this,arguments)}})();
},{"./libs.js":3}],15:[function(require,module,exports) {
"use strict";function e(e){return function(){var n=e.apply(this,arguments);return new Promise(function(e,r){return function t(o,i){try{var u=n[o](i),s=u.value}catch(e){return void r(e)}if(!u.done)return Promise.resolve(s).then(function(e){t("next",e)},function(e){t("throw",e)});e(s)}("next")})}}const n=require("./libs.js"),r=require("child_process");module.exports=(()=>{var r=e(function*(r){let t=r.usage("Usage: genie|g down [Options]").options("volumes",{alias:"v",describe:"関連するVolumeも一緒に削除する"}).argv;if(t.help)return console.log(),n.Message(r.help(),"primary",1);let o=n.loadConfig(t);if(o.core.memo)try{let e=o.core.memo.down;e&&n.Messages(e)}catch(e){Error("メモの設定が異常です。")}return new Promise((i=e(function*(e,r){yield Promise.all([n.dockerDown(o,t.v)]).catch(function(e){return e}).then(function(){e()})}),function(e,n){return i.apply(this,arguments)}));var i});return function(e){return r.apply(this,arguments)}})();
},{"./libs.js":3}],17:[function(require,module,exports) {
"use strict";function e(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,r){return function o(n,i){try{var s=t[n](i),c=s.value}catch(e){return void r(e)}if(!s.done)return Promise.resolve(c).then(function(e){o("next",e)},function(e){o("throw",e)});e(c)}("next")})}}const t=require("./libs.js"),r=require("child_process"),o=require("path");module.exports=(()=>{var n=e(function*(e){let n=e.usage("Usage: genie|g cli [Options] [Commands]").options("host",{describe:"実行するホスト名を指定する"}).argv;if(n.help)return console.log(),t.Message(e.help(),"primary",1);let i=t.loadConfig(n),s=n.host?n.host:i.core.docker.name,c=process.argv.slice(process.argv.findIndex(function(e){return e===n._[1]}));if(t.existContainers(i,"/"+s+"$")||t.Error("dockerコンテナが起動していません: "+s),1!==n._.length){let e=r.spawnSync("docker",["exec",s,...c]);e.status?t.Error(e.stderr.toString()||e.stdout.toString()):console.log(e.stdout.toString())}else{let e="/",t=process.cwd();0===t.indexOf(o.join(i.root,".genie"))&&(e=o.relative(o.join(i.root,".genie"),t),e=o.posix.join("/genie",e)),i.http.apache&&i.http.apache.enabled&&0===t.indexOf(o.join(i.root,i.http.apache.public_dir))&&(e=o.relative(o.join(i.root,i.http.apache.public_dir),t),e=o.posix.join("/var/www/html",e)),r.spawnSync("docker",["exec","-it",s,"bash","-c",`cd ${e} && bash`],{stdio:"inherit"})}});return function(e){return n.apply(this,arguments)}})();
},{"./libs.js":3}],19:[function(require,module,exports) {
"use strict";function e(e){return function(){var r=e.apply(this,arguments);return new Promise(function(e,t){return function o(n,l){try{var i=r[n](l),a=i.value}catch(e){return void t(e)}if(!i.done)return Promise.resolve(a).then(function(e){o("next",e)},function(e){o("throw",e)});e(a)}("next")})}}const r=require("./libs.js"),t=require("child_process"),o=require("inquirer"),n=require("cli-color");module.exports=(()=>{var l=e(function*(e){let l=e.usage("Usage: genie|g reject [Options]").options("force",{alias:"f",describe:"選択肢を出さずにすぐに削除を開始する"}).options("locked",{alias:"l",describe:"「locked_」から始まるボリューム・コンテナも対象にする"}).argv;if(l.help)return console.log(),r.Message(e.help(),"primary",1);let i=[],a=t.spawnSync("docker",["ps","-qa","--format","{{.Names}}\t{{.Status}}"]);a.status&&r.Error(a.stderr.toString());var c=!0,s=!1,u=void 0;try{for(var f,d=a.stdout.toString().trim().split(/\n/)[Symbol.iterator]();!(c=(f=d.next()).done);c=!0){let e=f.value;if(!e)continue;let r=e.split(/\t/),t=r[0],o=(r[1],t.match(/^locked_/)),a=`[Container] ${t}`;o&&(a=n.blackBright(a)),i.push({name:a,checked:!(o&&!l.locked)})}}catch(e){s=!0,u=e}finally{try{!c&&d.return&&d.return()}finally{if(s)throw u}}let m=[];(a=t.spawnSync("docker",["volume","ls","--format","{{.Name}}\t{{.Driver}}"])).status&&r.Error(a.stderr.toString());var y=!0,p=!1,v=void 0;try{for(var g,w=a.stdout.toString().trim().split(/\n/)[Symbol.iterator]();!(y=(g=w.next()).done);y=!0){let e=g.value;if(!e)continue;let r=e.split(/\t/),t=r[0],o=(r[1],t.match(/^locked_/)),i=`[Volume] ${t}`;o&&(i=n.blackBright(i)),m.push({name:i,checked:!(o&&!l.locked)})}}catch(e){p=!0,v=e}finally{try{!y&&w.return&&w.return()}finally{if(p)throw v}}let k,S=i.length+m.length;if(0===S)return h("対象のオブジェクトはありませんでした。");if(l.force){let e=[...i,...m];(k={}).rejects=[];var b=!0,$=!1,x=void 0;try{for(var j,q=e[Symbol.iterator]();!(b=(j=q.next()).done);b=!0){let e=j.value;e.checked&&k.rejects.push(e.name)}}catch(e){$=!0,x=e}finally{try{!b&&q.return&&q.return()}finally{if($)throw x}}}else{if(console.log(),!(k=yield o.prompt([{type:"checkbox",message:"削除したいものにチェックを入れて Enter してください。",name:"rejects",pageSize:100,choices:[...i,...m]}])).rejects.length)return;process.stdout.write(n.move.up(S));for(let e=0;e<S;e++)process.stdout.write(n.erase.line),process.stdout.write(n.move.down(1));process.stdout.write(n.move.up(S))}let P=[],C=[];var E=!0,V=!1,_=void 0;try{for(var B,N=k.rejects[Symbol.iterator]();!(E=(B=N.next()).done);E=!0){let e=B.value,r=(e=n.strip(e)).match(/^\[(Container|Volume)\] (.+)$/);"Container"===r[1]?C.push(r[2]):"Volume"===r[1]&&P.push(r[2])}}catch(e){V=!0,_=e}finally{try{!E&&N.return&&N.return()}finally{if(V)throw _}}console.log();let z=[];var D=!0,M=!1,O=void 0;try{for(var U,A=C[Symbol.iterator]();!(D=(U=A.next()).done);D=!0){let e=U.value;z.push(new Promise(function(r,o){t.spawn("docker",["rm","-fv",e]).stderr.on("data",function(r){console.log(`  [Container] ${e} - ${n.red("ng")}`),o(r)}).on("close",function(t){console.log(`  [Container] ${e} - ${n.green("deleted")}`),r()})}))}}catch(e){M=!0,O=e}finally{try{!D&&A.return&&A.return()}finally{if(M)throw O}}yield Promise.all(z).catch(function(e){r.Error(e)}),z=[];var F=!0,G=!1,H=void 0;try{for(var I,J=P[Symbol.iterator]();!(F=(I=J.next()).done);F=!0){let e=I.value;z.push(new Promise(function(r,o){t.spawn("docker",["volume","rm","-f",e]).stderr.on("data",function(r){console.log(`  [Volume] ${e} - ${n.red("ng")}`),o(r)}).on("close",function(t){console.log(`  [Volume] ${e} - ${n.green("deleted")}`),r()})}))}}catch(e){G=!0,H=e}finally{try{!F&&J.return&&J.return()}finally{if(G)throw H}}yield Promise.all(z).catch(function(e){r.Error(e)})});return function(e){return l.apply(this,arguments)}})();
},{"./libs.js":3}],21:[function(require,module,exports) {
"use strict";function r(r){return function(){var e=r.apply(this,arguments);return new Promise(function(r,t){return function n(o,i){try{var l=e[o](i),a=l.value}catch(r){return void t(r)}if(!l.done)return Promise.resolve(a).then(function(r){n("next",r)},function(r){n("throw",r)});r(a)}("next")})}}const e=require("./libs.js"),t=require("child_process"),n=require("cli-color");module.exports=(()=>{var o=r(function*(r){let o,i,l=r.usage("Usage: genie|g clean [Options]").options("force",{alias:"f",describe:"lockedから始まる名前も対象にする"}).argv;if(l.help)return console.log(),e.Message(r.help(),"primary",1);let a,s=0;a=[],o=["ps","-qa","--filter","exited=0","--format","{{.Names}}"],(i=t.spawnSync("docker",o)).status&&e.Error(i.stderr.toString());var c=!0,u=!1,f=void 0;try{for(var d,m=i.stdout.toString().trim().split(/\n/)[Symbol.iterator]();!(c=(d=m.next()).done);c=!0){let r=d.value;r&&(!l.f&&r.match(/^locked_/i)||a.push(new Promise(function(e,o){s++||console.log(),t.spawn("docker",["rm","-fv",r]).stderr.on("data",function(r){return o(r)}).on("close",function(t){console.log(`  [Container] ${r} - ${n.green("deleted")}`),e()})})))}}catch(r){u=!0,f=r}finally{try{!c&&m.return&&m.return()}finally{if(u)throw f}}yield Promise.all(a).catch(function(r){e.Error(r)}),a=[],o=["volume","ls","--filter","dangling=true","--format","{{.Name}}"],(i=t.spawnSync("docker",o)).status&&e.Error(i.stderr.toString());var g=!0,y=!1,p=void 0;try{for(var v,w=i.stdout.toString().trim().split(/\n/)[Symbol.iterator]();!(g=(v=w.next()).done);g=!0){let r=v.value;r&&(!l.f&&r.match(/^locked_/i)||a.push(new Promise(function(e,o){s++||console.log(),t.spawn("docker",["volume","rm","-f",r]).stderr.on("data",function(r){return o(r)}).on("close",function(t){console.log(`  [Volume] ${r} - ${n.green("deleted")}`),e()})})))}}catch(r){y=!0,p=r}finally{try{!g&&w.return&&w.return()}finally{if(y)throw p}}yield Promise.all(a).catch(function(r){e.Error(r)}),o=["images","-q","--filter","dangling=true"],(i=t.spawnSync("docker",o)).status&&e.Error(i.stderr.toString());var S=!0,k=!1,P=void 0;try{for(var x,E=i.stdout.toString().trim().split(/\n/)[Symbol.iterator]();!(S=(x=E.next()).done);S=!0){let r=x.value;r&&a.push(new Promise(function(e,o){s++||console.log(),t.spawn("docker",["rmi",r]).stderr.on("data",function(r){return o(r)}).on("close",function(t){console.log(`  [Image] ${r} - ${n.green("deleted")}`),e()})}))}}catch(r){k=!0,P=r}finally{try{!S&&E.return&&E.return()}finally{if(k)throw P}}yield Promise.all(a).catch(function(r){e.Error(r)}),s||h("対象のオブジェクトはありませんでした。")});return function(r){return o.apply(this,arguments)}})();
},{"./libs.js":3}],23:[function(require,module,exports) {
"use strict";function e(e){return function(){var n=e.apply(this,arguments);return new Promise(function(e,o){return function r(t,i){try{var c=n[t](i),s=c.value}catch(e){return void o(e)}if(!c.done)return Promise.resolve(s).then(function(e){r("next",e)},function(e){r("throw",e)});e(s)}("next")})}}const n=require("./libs.js"),o=require("child_process"),r=require("cli-color");module.exports=(()=>{var t=e(function*(e){let t=e.usage("Usage: genie|g build [Options]").options("no-cache",{alias:"n",describe:"キャッシュを使用せずにビルドする"}).argv;if(t.help)return console.log(),n.Message(e.help(),"primary",1);let i=n.loadConfig(t);if((yield n.Input(`${i.core.docker.image} イメージをビルドしてもよろしいでしょうか。[y/N]: `)).match(/^y$/i)){let e=["build","-t",i.core.docker.image];t["no-cache"]&&e.push("--no-cache"),e.push(`${n.getRootDir()}/.genie/image/`),n.Message(`ビルドを開始します。\ndocker ${e.join(" ")}`,"info"),console.log();let c=o.spawn("docker",e);c.stdout.on("data",function(e){console.log(r.blackBright(e.toString().trim()))}),c.stderr.on("data",function(e){n.Error(e)}),c.on("close",function(e){let o="ビルドが完了しました。";n.Message(o),n.Say(o)})}});return function(e){return t.apply(this,arguments)}})();
},{"./libs.js":3}],25:[function(require,module,exports) {
"use strict";function e(e){return function(){var r=e.apply(this,arguments);return new Promise(function(e,t){return function n(o,s){try{var i=r[o](s),l=i.value}catch(e){return void t(e)}if(!i.done)return Promise.resolve(l).then(function(e){n("next",e)},function(e){n("throw",e)});e(l)}("next")})}}const r=require("./libs.js"),t=require("child_process"),n=require("inquirer"),o=require("fs"),s=require("log-rotate");function i(t,o={},s){return 1===Object.keys(t.db.mysql).length?o.is_key_return?Object.keys(t.db.mysql)[0]:`${t.base_name}-mysql-${Object.keys(t.db.mysql)[0]}`:e(function*(){let e=[];var i=!0,l=!1,a=void 0;try{for(var c,y=Object.keys(t.db.mysql)[Symbol.iterator]();!(i=(c=y.next()).done);i=!0){let r=c.value;e.push(`${r} (${t.base_name}-mysql-${r})`)}}catch(e){l=!0,a=e}finally{try{!i&&y.return&&y.return()}finally{if(l)throw a}}o.has_all&&e.push("全て"),console.log();let u=yield n.prompt([{type:"list",message:s,name:"container",pageSize:100,choices:e}]).catch(function(e){r.Error(e)});if("全て"===u.container)return o.is_key_return?Object.keys(t.db.mysql):Object.keys(t.db.mysql).map(function(e){return`${t.base_name}-mysql-${e}`});{let e=u.container.match(/^(\w+) /);return o.is_key_return?e[1]:`${t.base_name}-mysql-${e[1]}`}})()}function l(e,r){let t;var n=!0,o=!1,s=void 0;try{for(var i,l=Object.keys(e.db.mysql)[Symbol.iterator]();!(n=(i=l.next()).done);n=!0){let n=i.value;if(r===`${e.base_name}-mysql-${n}`){t=n;break}}}catch(e){o=!0,s=e}finally{try{!n&&l.return&&l.return()}finally{if(o)throw s}}return t}function a(e){let r=t.execSync("docker volume ls -q");var n=!0,o=!1,s=void 0;try{for(var i,l=r.toString().split(/\n/)[Symbol.iterator]();!(n=(i=l.next()).done);n=!0){let r=i.value;if(r){if(r===e)return e;if(r===`locked_${e}`)return`locked_${e}`}}}catch(e){o=!0,s=e}finally{try{!n&&l.return&&l.return()}finally{if(o)throw s}}return!1}module.exports=(()=>{var n=e(function*(n){let c=n.usage("Usage: genie|g mysql [Options]").options("cli",{alias:"c",describe:"MySQLコンテナのCLIに入る",boolean:!0}).options("dump",{alias:"d",describe:"MySQLのダンプを取る",boolean:!0}).options("restore",{alias:"r",describe:"MySQLのリストアを行う",boolean:!0}).options("all",{alias:"a",describe:"管轄全てのMySQLを対象とする。（--dump, --restore時のみ）",boolean:!0}).options("no-rotate",{alias:"n",describe:"ダンプファイルのローテーションを行わない。（--dump時のみ）",boolean:!0}).options("output-dir",{alias:"o",describe:"ダンプファイルの出力先を指定。（--dump時のみ、ホスト側のフルパス指定）"}).options("gzip",{alias:"g",describe:"ダンプファイルは圧縮。（--dump時に影響）",boolean:!0}).argv;if(c.help)return console.log(),r.Message(n.help(),"primary",1);let y=r.loadConfig(c);if(y.db.mysql&&Object.keys(y.db.mysql).length||r.Error("MySQL設定がありません。"),r.existContainers(y,"/"+y.base_name+"$")||r.Error("dockerコンテナが起動していません: "+y.base_name),c.cli){let e=c._[1]?`${y.base_name}-mysql-${c._[1]}`:yield i(y,{is_single:!0},"コマンドラインに入るMySQLコンテナを選択してください。");l(y,e);t.spawnSync("docker",["exec","-it",e,"bash"],{stdio:"inherit"})}else if(c.dump){c._.shift();let n=c.all?Object.keys(y.db.mysql):c._.length?c._:yield i(y,{has_all:!0,is_key_return:!0},"ダンプを取るMySQLコンテナを選択してください。");Array.isArray(n)||(n=[n]);let l=`${y.root}/.genie/files/opt/mysql/dumps`;c.o&&(l=c.o.replace(/\/$/,"")),o.existsSync(l)||o.mkdirSync(l,493);let a=[];var u=!0,d=!1,m=void 0;try{for(var f,p=n[Symbol.iterator]();!(u=(f=p.next()).done);u=!0){let r=f.value,n=`${y.base_name}-mysql-${r}`;a.push({label:n,proc:"dumping",ok:"dumped!",ng:"failed!",func:new Promise((()=>{var i=e(function*(e,i){y.db.mysql[r]||i("指定のキーのMySQL設定が定義されていません。"+r);let a=y.db.mysql[r];if(!c.n){let e=`${l}/${r}.sql${c.g?".gz":""}`;o.existsSync(e)&&(yield new Promise(function(r,t){s(e,{count:a.dump_genel+1},function(e){e?t(e):r()})}))}let u="docker run -d"+` --name ${n}-dumper`+" -e MYSQL_ROOT_PASSWORD=1"+` --link ${n}`+` -v ${l}:/dumps/`+(y.core.docker.network?` --net=${y.core.docker.network}`:"")+(y.core.docker.options?` ${y.core.docker.options}`:"")+` ${a.repository}`+" mysqld"+(a.charset?` --character-set-server=${a.charset}`:"")+(a.collation?` --collation-server=${a.collation}`:"");t.execSync(u);let d="docker exec"+` ${n}-dumper`+" sh -c"+` "mysqldump --single-transaction -h ${n} -u${a.user} -p${a.pass} ${a.name} > /dumps/${r}.sql${c.g?".gz":""}"`;t.exec(d,function(r,o,s){t.exec(`docker rm -fv ${n}-dumper`),r&&i(r),e()})});return function(e,r){return i.apply(this,arguments)}})())})}}catch(e){d=!0,m=e}finally{try{!u&&p.return&&p.return()}finally{if(d)throw m}}yield r.para_progress(a)}else if(c.restore){c._.shift();let e=c.all?Object.keys(y.db.mysql):c._.length?c._:yield i(y,{has_all:!0,is_key_return:!0},"リストアするMySQLコンテナを選択してください。");Array.isArray(e)||(e=[e]);let n=[];var b=!0,$=!1,h=void 0;try{for(var _,k=e[Symbol.iterator]();!(b=(_=k.next()).done);b=!0){let e=_.value,r=`${y.base_name}-mysql-${e}`;n.push({label:r,proc:"restoring",ok:"restored!",ng:"failed!",func:new Promise(function(e,n){t.exec(`docker exec ${r} sh -c "cat /docker-run.cmd"`,function(o,s,i){let l=s.toString().trim();o&&n(o);let c=a(r);t.exec(`docker rm -f -v ${r}`,function(o,s,i){o&&n(o),t.exec(`docker volume rm -f ${c}`,function(o,s,i){t.exec(l,function(o,s,i){o&&n(o),t.exec(`docker exec ${r} sh -c "echo '${l}' > /docker-run.cmd"`,function(o,s,i){o&&n(o);setTimeout(function n(){t.execSync(`docker logs ${r}`).toString().match(/MySQL init process done\. Ready for start up\./)?e():setTimeout(n,100)},100)})})})})})})})}}catch(e){$=!0,h=e}finally{try{!b&&k.return&&k.return()}finally{if($)throw h}}yield r.para_progress(n)}else{let e=c._[1]?`${y.base_name}-mysql-${c._[1]}`:yield i(y,{is_single:!0},"mysqlコマンドラインに入るMySQLコンテナを選択してください。"),n=l(y,e);y.db.mysql[n]||r.Error("指定のキーのMySQL設定が定義されていません。"+c._[1]),t.spawnSync("docker",["exec","-it",e,"mysql",y.db.mysql[n].name,`-u${y.db.mysql[n].user}`,`-p${y.db.mysql[n].pass}`],{stdio:"inherit"})}});return function(e){return n.apply(this,arguments)}})();
},{"./libs.js":3}],27:[function(require,module,exports) {
"use strict";function e(e){return function(){var r=e.apply(this,arguments);return new Promise(function(e,t){return function o(s,n){try{var i=r[s](n),l=i.value}catch(e){return void t(e)}if(!i.done)return Promise.resolve(l).then(function(e){o("next",e)},function(e){o("throw",e)});e(l)}("next")})}}const r=require("./libs.js"),t=require("child_process"),o=require("inquirer"),s=require("fs"),n=require("log-rotate");function i(t,s={},n){return 1===Object.keys(t.db.postgresql).length?s.is_key_return?Object.keys(t.db.postgresql)[0]:`${t.base_name}-postgresql-${Object.keys(t.db.postgresql)[0]}`:e(function*(){let e=[];var i=!0,l=!1,a=void 0;try{for(var c,u=Object.keys(t.db.postgresql)[Symbol.iterator]();!(i=(c=u.next()).done);i=!0){let r=c.value;e.push(`${r} (${t.base_name}-postgresql-${r})`)}}catch(e){l=!0,a=e}finally{try{!i&&u.return&&u.return()}finally{if(l)throw a}}s.has_all&&e.push("全て"),console.log();let p=yield o.prompt([{type:"list",message:n,name:"container",pageSize:100,choices:e}]).catch(function(e){r.Error(e)});if("全て"===p.container)return s.is_key_return?Object.keys(t.db.postgresql):Object.keys(t.db.postgresql).map(function(e){return`${t.base_name}-postgresql-${e}`});{let e=p.container.match(/^(\w+) /);return s.is_key_return?e[1]:`${t.base_name}-postgresql-${e[1]}`}})()}function l(e,r){let t;var o=!0,s=!1,n=void 0;try{for(var i,l=Object.keys(e.db.postgresql)[Symbol.iterator]();!(o=(i=l.next()).done);o=!0){let o=i.value;if(r===`${e.base_name}-postgresql-${o}`){t=o;break}}}catch(e){s=!0,n=e}finally{try{!o&&l.return&&l.return()}finally{if(s)throw n}}return t}function a(e){let r=t.execSync("docker volume ls -q");var o=!0,s=!1,n=void 0;try{for(var i,l=r.toString().split(/\n/)[Symbol.iterator]();!(o=(i=l.next()).done);o=!0){let r=i.value;if(r){if(r===e)return e;if(r===`locked_${e}`)return`locked_${e}`}}}catch(e){s=!0,n=e}finally{try{!o&&l.return&&l.return()}finally{if(s)throw n}}return!1}module.exports=(()=>{var o=e(function*(o){let c=o.usage("Usage: genie|g psql [Options]").options("cli",{alias:"c",describe:"PostgreSQLコンテナのCLIに入る",boolean:!0}).options("dump",{alias:"d",describe:"PostgreSQLのダンプを取る",boolean:!0}).options("restore",{alias:"r",describe:"PostgreSQLのリストアを行う",boolean:!0}).options("all",{alias:"a",describe:"管轄全てのPostgreSQLを対象とする。（--dump, --restore時のみ）",boolean:!0}).options("no-rotate",{alias:"n",describe:"ダンプファイルのローテーションを行わない。（--dump時のみ）",boolean:!0}).options("output-dir",{alias:"o",describe:"ダンプファイルの出力先を指定。（--dump時のみ、ホスト側のフルパス指定）"}).options("gzip",{alias:"g",describe:"ダンプファイルは圧縮。（--dump時に影響）",boolean:!0}).argv;if(c.help)return console.log(),r.Message(o.help(),"primary",1);let u=r.loadConfig(c);if(u.db.postgresql&&Object.keys(u.db.postgresql).length||r.Error("PostgreSQL設定がありません。"),r.existContainers(u,"/"+u.base_name+"$")||r.Error("dockerコンテナが起動していません: "+u.base_name),c.cli){let e=c._[1]?`${u.base_name}-postgresql-${c._[1]}`:yield i(u,{is_single:!0},"コマンドラインに入るPostgreSQLコンテナを選択してください。");l(u,e);t.spawnSync("docker",["exec","-it",e,"bash"],{stdio:"inherit"})}else if(c.dump){c._.shift();let o=c.all?Object.keys(u.db.postgresql):c._.length?c._:yield i(u,{has_all:!0,is_key_return:!0},"ダンプを取るPostgreSQLコンテナを選択してください。");Array.isArray(o)||(o=[o]);let l=`${u.root}/.genie/files/opt/postgresql/dumps`;c.o&&(l=c.o.replace(/\/$/,"")),s.existsSync(l)||s.mkdirSync(l,493);let a=[];var p=!0,d=!1,g=void 0;try{for(var f,y=o[Symbol.iterator]();!(p=(f=y.next()).done);p=!0){let r=f.value,o=`${u.base_name}-postgresql-${r}`;a.push({label:o,proc:"dumping",ok:"dumped!",ng:"failed!",func:new Promise((()=>{var i=e(function*(e,i){u.db.postgresql[r]||i("指定のキーのPostgreSQL設定が定義されていません。"+r);let a=u.db.postgresql[r];if(!c.n){let e=`${l}/${r}.sql${c.g?".gz":""}`;s.existsSync(e)&&(yield new Promise(function(t,o){n(e,{count:u.db.postgresql[r].dump_genel+1},function(e){e?o(e):t()})}))}let p="docker run -d"+` --name ${o}-dumper`+` --link ${o}`+` -v ${l}:/dumps/`+(u.core.docker.network?` --net=${u.core.docker.network}`:"")+(u.core.docker.options?` ${u.core.docker.options}`:"")+` ${a.repository}`+" postgres";t.execSync(p);let d="docker exec"+` ${o}-dumper`+` sh -c "echo '${o}:5432:${a.name}:${a.user}:${a.pass}' > /root/.pgpass && chmod 0600 /root/.pgpass"`;t.execSync(d);let g="docker exec"+` ${o}-dumper`+` sh -c "pg_dump ${a.name} -U ${a.user} -h ${o} | gzip > /dumps/${r}.sql${c.g?".gz":""}"`;t.exec(g,function(r,s,n){t.exec(`docker rm -fv ${o}-dumper`),r&&i(r),e()})});return function(e,r){return i.apply(this,arguments)}})())})}}catch(e){d=!0,g=e}finally{try{!p&&y.return&&y.return()}finally{if(d)throw g}}yield r.para_progress(a)}else if(c.restore){c._.shift();let e=c.all?Object.keys(u.db.postgresql):c._.length?c._:yield i(u,{has_all:!0,is_key_return:!0},"リストアするPostgreSQLコンテナを選択してください。");Array.isArray(e)||(e=[e]);let o=[];var m=!0,b=!1,$=void 0;try{for(var h,_=e[Symbol.iterator]();!(m=(h=_.next()).done);m=!0){let e=h.value,r=`${u.base_name}-postgresql-${e}`;o.push({label:r,proc:"restoring",ok:"restored!",ng:"failed!",func:new Promise(function(e,o){t.exec(`docker exec ${r} sh -c "cat /docker-run.cmd"`,function(s,n,i){let l=n.toString().trim();s&&o(s);let c=a(r);t.exec(`docker rm -f ${r}`,function(s,n,i){s&&o(s),t.exec(`docker volume rm -f ${c}`,function(s,n,i){t.exec(l,function(s,n,i){s&&o(s),t.exec(`docker exec ${r} sh -c "echo '${l}' > /docker-run.cmd"`,function(s,n,i){s&&o(s);setTimeout(function o(){"0"===t.spawnSync("docker",["exec",r,"sh","-c","ps aux|grep entrypoint.sh|grep -v grep|wc -l"]).stdout.toString().trim()?e():setTimeout(o,1e3)},1e3)})})})})})})})}}catch(e){b=!0,$=e}finally{try{!m&&_.return&&_.return()}finally{if(b)throw $}}yield r.para_progress(o)}else{let e=c._[1]?`${u.base_name}-postgresql-${c._[1]}`:yield i(u,{is_single:!0},"psqlコマンドラインに入るPostgreSQLコンテナを選択してください。"),o=l(u,e);u.db.postgresql[o]||r.Error("指定のキーのPostgreSQL設定が定義されていません。"+c._[1]),t.spawnSync("docker",["exec","-it",e,"psql",u.db.postgresql[o].name,"-U",u.db.postgresql[o].user],{stdio:"inherit"})}});return function(e){return o.apply(this,arguments)}})();
},{"./libs.js":3}],29:[function(require,module,exports) {
"use strict";function e(e){return function(){var r=e.apply(this,arguments);return new Promise(function(e,t){return function o(a,n){try{var i=r[a](n),s=i.value}catch(e){return void t(e)}if(!i.done)return Promise.resolve(s).then(function(e){o("next",e)},function(e){o("throw",e)});e(s)}("next")})}}const r=require("./libs.js"),t=require("child_process"),o=require("cli-color");function a(e){r.existContainers(e,"/"+e.base_name+"$")||r.Error("dockerコンテナが起動していません: "+e.base_name);let t=r.get_external_port(e,"https"===e.http.browser.schema?443:80);return!!t&&(t="http"===e.http.browser.schema&&80==t||"https"===e.http.browser.schema&&443==t?"":`:${t}`,`${e.http.browser.schema}://${e.host_ip}${t}${e.http.browser.path}`)}function n(e){r.existContainers(e,"/"+e.base_name+"$")||r.Error("dockerコンテナが起動していません: "+e.base_name);let t=r.get_external_port(e,9981);return`http://${e.host_ip}:${t}`}module.exports=(()=>{var o=e(function*(e){let o=e.usage("Usage: genie|g open [Option|URL]").options("site",{alias:"s",describe:"既定のブラウザで開発サイトを開く",boolean:!0}).options("report",{alias:"r",describe:"既定のブラウザでテストレポートを開く",boolean:!0}).options("maildev",{alias:"m",describe:"既定のブラウザでMailDevページを開く",boolean:!0}).options("code",{alias:"c",describe:"管理フォルダをVisualStudioCodeで開く",boolean:!0}).argv;if(o.help)return console.log(),r.Message(e.help(),"primary",1);let i=r.loadConfig(o),s=r.isWindows()?"start":r.isMac?"open":"xdg-open";if(o._.shift(),o._.length){var l=!0,c=!1,p=void 0;try{for(var h,u=o._[Symbol.iterator]();!(l=(h=u.next()).done);l=!0){let e=h.value;t.exec(`${s} ${e}`)}}catch(e){c=!0,p=e}finally{try{!l&&u.return&&u.return()}finally{if(c)throw p}}}if(o.s&&t.exec(`${s} ${a(i)}`),o.r&&t.exec(`${s} ${i.root}/tests-report/mochawesome-report/mochawesome.html`),o.l&&t.exec(`${s} ${n(i)}`),o.c&&t.exec(`code ${i.root}`),o.s||o.r||o.l||o.c||o._.length)return;let f=a(i);if(!f)return!1;let m=[];i.http.browser.apps&&i.http.browser.apps.length||(i.http.browser.apps=[""]);var b=!0,d=!1,$=void 0;try{for(var x,v=i.http.browser.apps[Symbol.iterator]();!(b=(x=v.next()).done);b=!0){let e=x.value,t="";r.isWindows()?"chrome"===e?t=" chrome":"firefox"===e?t=" firefox":"ie"===e?t=" explorer":"opera"===e?t=" opera":e&&(t=` ${e}`):"chrome"===e?t=' -a "Google Chrome"':"firefox"===e?t=" -a firefox":"safari"===e?t=" -a safari":"opera"===e?t=" -a opera":e&&(t=` -a ${e}`),m.push(`${s}${t} ${f}`)}}catch(e){d=!0,$=e}finally{try{!b&&v.return&&v.return()}finally{if(d)throw $}}var y=!0,w=!1,g=void 0;try{for(var _,C=m[Symbol.iterator]();!(y=(_=C.next()).done);y=!0){let e=_.value;t.execSync(e)}}catch(e){w=!0,g=e}finally{try{!y&&C.return&&C.return()}finally{if(w)throw g}}});return function(e){return o.apply(this,arguments)}})();
},{"./libs.js":3}],31:[function(require,module,exports) {
"use strict";function r(r){return function(){var e=r.apply(this,arguments);return new Promise(function(r,t){return function n(o,i){try{var a=e[o](i),l=a.value}catch(r){return void t(r)}if(!a.done)return Promise.resolve(l).then(function(r){n("next",r)},function(r){n("throw",r)});r(l)}("next")})}}const e=require("./libs.js"),t=require("child_process");module.exports=(()=>{var n=r(function*(r){let n=r.usage("Usage: genie|g logs [Options] [Commands]").argv;if(n.help)return console.log(),e.Message(r.help(),"primary",1);let o=e.loadConfig(n);e.existContainers(o,`/${o.base_name}$`)||e.Error("dockerコンテナが起動していません: "+o.base_name);let i=[];try{if(!(o.log.tail&&o.log.tail[0]&&o.log.tail[0].length))throw new Error("ログ設定が正しくありません。");o.log.tail.length>1&&i.push("-s","2");var a=!0,l=!1,s=void 0;try{for(var u,c=o.log.tail[Symbol.iterator]();!(a=(u=c.next()).done);a=!0){let r=u.value,e=!0;var f=!0,h=!1,y=void 0;try{for(var p,g=r[Symbol.iterator]();!(f=(p=g.next()).done);f=!0){let r=p.value;if("object"==typeof r&&Array.isArray(r))i.push("-ci",r[1]),e||i.push("-I"),i.push(r[0]);else{if("string"!=typeof r)throw new Error("ログ設定が正しくない可能性があります。（指定できるのは文字列か配列のみです）"+r);e||i.push("-I"),i.push(r)}e=!1}}catch(r){h=!0,y=r}finally{try{!f&&g.return&&g.return()}finally{if(h)throw y}}}}catch(r){l=!0,s=r}finally{try{!a&&c.return&&c.return()}finally{if(l)throw s}}}catch(r){e.Error(r)}t.spawnSync("docker",["exec","-it",o.base_name,"multitail",...i],{stdio:"inherit"})});return function(r){return n.apply(this,arguments)}})();
},{"./libs.js":3}],33:[function(require,module,exports) {
"use strict";function e(e){return function(){var r=e.apply(this,arguments);return new Promise(function(e,n){return function t(o,s){try{var c=r[o](s),u=c.value}catch(e){return void n(e)}if(!c.done)return Promise.resolve(u).then(function(e){t("next",e)},function(e){t("throw",e)});e(u)}("next")})}}const r=require("./libs.js"),n=require("fs"),t=require("child_process");module.exports=(()=>{var o=e(function*(e){let o=e.usage("Usage: genie|g dlsync [Options]").argv;if(o.help)return console.log(),r.Message(e.help(),"primary",1);let s=r.loadConfig(o);s.trans.dlsync.remote_host&&s.trans.dlsync.remote_user||r.Error("dlsyncの設定情報がありません。");let c=`${s.root}/${s.trans.dlsync.local_dir}`;try{n.accessSync(c)}catch(e){n.mkdirSync(c)}let u=[];u.push("run","-d","-it","--rm"),u.push("-e","TERM=xterm-256color"),u.push("-e","LANG=ja_JP.UTF-8"),u.push("-e","LC_ALL=ja_JP.UTF-8"),u.push("-e","GENIE_PROC=dlsync"),u.push("-v",`${c}:/sync`),u.push("--label",`genie_runmode="${s.runmode}"`),u.push("--label",`genie_root="${s.root}"`),u.push(`--name=${s.base_name}-DLSYNC`),s.core.docker.network&&u.push(`--net=${s.core.docker.network}`),s.core.docker.options&&u.push(`${s.core.docker.options}`);let i=r.data2envs(s,"GENIE");i.GENIE_RUNMODE=s.runmode;let l=Object.keys(i);for(let e=0;e<l.length;e++)u.push("-e",`${l[e]}=${i[l[e]]}`);u.push(s.core.docker.image);let a=t.spawnSync("docker",u);a.status&&Error(a.stderr.toString()),r.Say("ダウンロード同期が完了しました。")});return function(e){return o.apply(this,arguments)}})();
},{"./libs.js":3}],35:[function(require,module,exports) {
"use strict";function e(e){return function(){var r=e.apply(this,arguments);return new Promise(function(e,t){return function o(n,i){try{var s=r[n](i),c=s.value}catch(e){return void t(e)}if(!s.done)return Promise.resolve(c).then(function(e){o("next",e)},function(e){o("throw",e)});e(c)}("next")})}}const r=require("./libs.js"),t=require("fs"),o=require("child_process"),n=require("inquirer"),i=require("cli-color");module.exports=(()=>{var n=e(function*(e){let n=e.usage("Usage: genie|g test [Options] [test paths/files]").options("mode",{alias:"M",default:"test",describe:"実行モードを指定可能（test時はデフォルト`test`）"}).options("open",{alias:"o",describe:"dockerホスト側のChromeブラウザを開きオートテストを実行する",boolean:!0}).argv;if(n.help)return console.log(),r.Message(e.help(),"primary",1);process.env.GENIE_RUNMODE=n.mode;let i=r.loadConfig(n),s=`${i.root}/tests/`;n._[1]&&(s=n._[1]);try{if(!t.readdirSync(s).length)throw new Error}catch(e){r.Error(`${s} にテストスクリプトを配置してください。`)}yield CMDS.up(e),process.chdir(i.root),n.o&&(process.env.GENIE_TEST_BROWSER_OPEN="on"),i.test.before&&o.execSync(i.test.before,{stdio:"inherit"});o.execSync(i.test.run,{stdio:"inherit"});i.test.after&&o.execSync(i.test.after,{stdio:"inherit"}),yield CMDS.down(e)});return function(e){return n.apply(this,arguments)}})();
},{"./libs.js":3}],39:[function(require,module,exports) {
module.exports={name:"genie-cmd",description:"genie by node",version:"0.0.55",license:"MIT",private:!1,bin:{genie:"dist/genie",g:"dist/genie"},scripts:{dev:"npx parcel watch src/genie.js --out-dir dist --out-file genie --target node --no-source-maps",build:"npx parcel build src/genie.js --out-dir dist --out-file genie --target node --no-source-maps --no-cache && node src/build-after.js",test:"npx mocha --recursive tests --reporter mochawesome --reporter-options reportDir=tests-report/mochawesome-report/,quiet=true & start chrome tests-report/mochawesome-report/mochawesome.html","test-in-mac":"npx mocha --recursive tests --reporter mochawesome --reporter-options reportDir=tests-report/mochawesome-report,quiet=true,autoOpen=true"},devDependencies:{"parcel-bundler":"^1.7.1"},dependencies:{"cli-color":"^1.2.0",cliui:"^4.1.0","fs-extra":"^6.0.1",inquirer:"^5.2.0","jp-wrap":"^0.2.2","log-rotate":"^0.2.8",mocha:"^5.2.0",mochawesome:"^3.0.2",optimist:"^0.6.1","string-width":"^2.1.1",puptester:"^0.0.2"}};
},{}],37:[function(require,module,exports) {
"use strict";function r(r){return function(){var e=r.apply(this,arguments);return new Promise(function(r,n){return function t(o,u){try{var i=e[o](u),s=i.value}catch(r){return void n(r)}if(!i.done)return Promise.resolve(s).then(function(r){t("next",r)},function(r){t("throw",r)});r(s)}("next")})}}const e=require("./libs.js");module.exports=(()=>{var n=r(function*(r){e.showRunmode();var n=require("../package.json");process.stdout.write("\n"),e.Message(`${n.name} ver ${n.version}`,"primary"),process.stdout.write("\n")});return function(r){return n.apply(this,arguments)}})();
},{"./libs.js":3,"../package.json":39}],1:[function(require,module,exports) {
"use strict";function e(e){return function(){var i=e.apply(this,arguments);return new Promise(function(e,n){return function s(l,r){try{var o=i[l](r),t=o.value}catch(e){return void n(e)}if(!o.done)return Promise.resolve(t).then(function(e){s("next",e)},function(e){s("throw",e)});e(t)}("next")})}}const i=require("optimist"),n=require("child_process"),s=require("./libs.js");global.d=s.d,global.h=s.h,console.time("  Done"),global.CMDS={demo:e=>require("./cmd-demo.js")(e),init:e=>require("./cmd-init.js")(e),config:e=>require("./cmd-config.js")(e),ls:e=>require("./cmd-ls.js")(e),up:e=>require("./cmd-up.js")(e),down:e=>require("./cmd-down.js")(e),cli:e=>require("./cmd-cli.js")(e),reject:e=>require("./cmd-reject.js")(e),clean:e=>require("./cmd-clean.js")(e),build:e=>require("./cmd-build.js")(e),mysql:e=>require("./cmd-mysql.js")(e),psql:e=>require("./cmd-psql.js")(e),open:e=>require("./cmd-open.js")(e),logs:e=>require("./cmd-logs.js")(e),dlsync:e=>require("./cmd-dlsync.js")(e),test:e=>require("./cmd-test.js")(e),version:e=>require("./cmd-version.js")(e)};let l=i.usage("Usage: genie|g [Commands] [Options]").options("mode",{alias:"M",default:process.env.GENIE_RUNMODE||"develop",describe:"実行モードを指定可能"}).options("config",{alias:"C",default:"config.js",describe:"設定ファイルを指定可能"}).options("help",{alias:"h",describe:"説明表示"}).argv;process.env.GENIE_RUNMODE=l.mode,e(function*(){let e=l._.shift();if("demo"===e)yield CMDS.demo(i);else if("init"===e)yield CMDS.init(i);else if("config"===e)yield CMDS.config(i);else if("ls"===e)yield CMDS.ls(i);else if("up"===e)yield CMDS.up(i);else if("down"===e)yield CMDS.down(i);else if("cli"===e)yield CMDS.cli(i);else if("reject"===e)yield CMDS.reject(i);else if("clean"===e)yield CMDS.clean(i);else if("build"===e)yield CMDS.build(i);else if("mysql"===e)yield CMDS.mysql(i);else if("psql"===e)yield CMDS.psql(i);else if("open"===e)yield CMDS.open(i);else if("logs"===e)yield CMDS.logs(i);else if("dlsync"===e)yield CMDS.dlsync(i);else if("httpd"===e)yield CMDS.httpd(i);else if("test"===e)yield CMDS.test(i);else if("version"===e)yield CMDS.version(i);else{let m=s.loadConfig(l),u="";if(Object.keys(m.command).length){var r=!0,o=!1,t=void 0;try{for(var d,c=Object.keys(m.command)[Symbol.iterator]();!(r=(d=c.next()).done);r=!0){let e=d.value,i=8-e.length;i<1&&(i=1),u+=`  ${e} ${s.Repeat(" ",i)} ${m.command[e]}\n`}}catch(e){o=!0,t=e}finally{try{!r&&c.return&&c.return()}finally{if(o)throw t}}}m.command[e]?(s.existContainers(m,`/${m.base_name}$`)||s.Error("dockerコンテナが起動していません: "+m.base_name),n.spawnSync("docker",["exec","-it",m.base_name,"bash","-c",`${m.command[e]}`],{stdio:"inherit"})):(console.log(),s.Message(i.help()+"\nCommands:\n  init      現在のディレクトリに .genie/ を作成します。\n  config    設定を確認する\n  ls        Dockerコンテナ状況を確認する\n  up        設定に基づきDockerコンテナを起動する\n  down      関連するコンテナのみ終了する\n  cli       コンテナ内でコマンドを実行。またはコンテナに入る\n  reject    genie対象外のコンテナまたはボリュームを一括削除する\n  clean     不要なイメージ・終了済みコンテナ・リンクされてないボリュームを一括削除する\n  build     基本のdockerイメージをビルドする\n  mysql     MySQLクライアント実行\n  psql      PostgreSQLクライアント実行\n  open      ブラウザで開く\n  logs      実行ログを見る\n  dlsync    LFTPを利用したダウンロード方向のみのミラーリングを実行する\n  httpd     \n  test      テストを実行する\n  demo      デモ\n  version   バージョン表示\n"+(u||""),"warning",1))}process.stdout.write("\n"),console.timeEnd("  Done"),process.stdout.write("\n")})();
},{"./libs.js":3,"./cmd-demo.js":5,"./cmd-init.js":7,"./cmd-config.js":9,"./cmd-ls.js":11,"./cmd-up.js":13,"./cmd-down.js":15,"./cmd-cli.js":17,"./cmd-reject.js":19,"./cmd-clean.js":21,"./cmd-build.js":23,"./cmd-mysql.js":25,"./cmd-psql.js":27,"./cmd-open.js":29,"./cmd-logs.js":31,"./cmd-dlsync.js":33,"./cmd-test.js":35,"./cmd-version.js":37}]},{},[1], null)