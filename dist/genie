#!/usr/bin/env node
parcelRequire=function(e,r,n){var t="function"==typeof parcelRequire&&parcelRequire,i="function"==typeof require&&require;function u(n,o){if(!r[n]){if(!e[n]){var f="function"==typeof parcelRequire&&parcelRequire;if(!o&&f)return f(n,!0);if(t)return t(n,!0);if(i&&"string"==typeof n)return i(n);var c=new Error("Cannot find module '"+n+"'");throw c.code="MODULE_NOT_FOUND",c}a.resolve=function(r){return e[n][1][r]||r};var l=r[n]=new u.Module(n);e[n][0].call(l.exports,a,l,l.exports)}return r[n].exports;function a(e){return u(a.resolve(e))}}u.isParcelRequire=!0,u.Module=function(e){this.id=e,this.bundle=u,this.exports={}},u.modules=e,u.cache=r,u.parent=t;for(var o=0;o<n.length;o++)u(n[o]);return u}({3:[function(require,module,exports) {
"use strict";const fs=require("fs"),strwidth=require("string-width"),color=require("cli-color"),wrap=require("jp-wrap")(color.windowSize.width-8),readline=require("readline").createInterface(process.stdin,process.stdout),child=require("child_process"),path=require("path"),util=require("util"),d=module.exports.d=(e=>console.log(util.inspect(e,{colors:!0,compact:!1,breakLength:10,depth:10}))),h=module.exports.h=((e,o=color.white)=>console.log("\n  "+o(e))),getRootDir=module.exports.getRootDir=(()=>{let e="",o=__dirname,r=!0;do{try{fs.accessSync(o+"/.genie"),e=o}catch(e){o===(o=path.dirname(o))&&(r=!1)}}while(""===e&&r);if(e)return e;Error("先祖ディレクトリに .genie/ が見つかりませんでした。\n`genie init` などして初期化してください。")}),Repeat=module.exports.Repeat=((e,o=1)=>{if(!o>0)return"";let r="";for(let t=0;t<o;t++)r+=e;return r}),Message=module.exports.Message=((e,o="default",r=0)=>{let t=color.white,s=color.white;"primary"===o?(t=color.xterm(26),s=color.xterm(39)):"success"===o?(t=color.green,s=color.greenBright):"danger"===o?(t=color.red,s=color.redBright):"warning"===o?(t=color.yellow,s=color.yellowBright):"info"===o?(t=color.whiteBright,s=color.whiteBright):"whisper"===o&&(t=color.blackBright,s=color.blackBright);let n=(e=wrap(e.replace(/[\r\n]+$/,""))).split(/[\r\n]+/),l=0;for(let e in n){let o=strwidth(n[e]);l<o&&(l=o)}l+=2,console.log("  "+t("┏")+t(Repeat("─",l))+t("┓"));for(let e in n)r>0&&r==e&&console.log("  "+t("┣")+t(Repeat("─",l))+t("┫")),console.log("  "+t("│")+s(" "+n[e]+" ")+Repeat(" ",l-2-strwidth(n[e]))+t("│"));console.log("  "+t("┗")+t(Repeat("─",l))+t("┛"))}),Messages=module.exports.Messages=(e=>{Array.isArray(e)||(e=[e]);for(let o in e)for(let r in e[o])Message(e[o][r],r)}),Input=module.exports.Input=((e,o=20)=>{let r=color.bgBlack("  "),t=strwidth(e="  "+e+"  ")+o,s=color.whiteBright.bgBlueBright,n=color.bgBlue;return console.log("\n"+r+s(Repeat(" ",t))+"\n"+r+s(e+Repeat(" ",o))+"\n"+r+s(Repeat(" ",t))+"\n"+r+n(Repeat(" ",t))),process.stdout.write(color.move.up(3)),process.stdout.write(color.move.right(t-o)),new Promise(e=>{readline.on("line",o=>{process.stdout.write(color.move.down(3)),e(o)})})}),Say=module.exports.Say=(e=>{if(0!==e.length)if(isMac())child.execSync(`say -r 300 "${e}"`);else if(isWindows()){let o=fs.mkdtempSync(process.env.TEMP+"/genie-say-"),r=o+"/say.js";fs.writeFileSync(r,"var args = [];for(var i = 0; i < WScript.Arguments.length; i++) args.push(WScript.Arguments.Item(i));WScript.CreateObject('SAPI.SpVoice').Speak('<volume level=\"100\">'+'<rate speed=\"2\">'+'<pitch middle=\"0\">'+args.join(' ')+'</pitch>'+'</rate>'+'</volume>', 8);"),child.execSync(`start wscript ${r} "${e}"`),fs.unlinkSync(r),fs.rmdirSync(o)}}),showRunmode=module.exports.showRunmode=(e=>{console.log(color.blackBright(`<${process.env.GENIE_RUNMODE}>`))}),loadConfig=module.exports.loadConfig=(argv=>{let root_dir=getRootDir(),config_js=`${root_dir}/.genie/${argv.config}`;try{fs.accessSync(config_js)}catch(e){Error(`設定ファイル（.genie/${argv.config}）が見つかりませんでした。`)}let config=require(config_js).config;if(config.runmode=argv.mode,config.base_name=config.core.docker.name,config.root=getRootDir(),!config.core.docker.machine&&process.env.DOCKER_MACHINE_NAME&&(config.core.docker.machine=process.env.DOCKER_MACHINE_NAME),config.core.docker.ip_force)config.host_ip=config.core.docker.ip_force;else if(hasDockerMachineEnv()&&config.core.docker.machine){let e=child.spawnSync("docker-machine",["ip",config.core.docker.machine]);e.status&&Error(e.stderr.toString()),config.host_ip=e.stdout.toString().trim()}else config.host_ip="localhost";let paths=path.parse(config_js),add_config_js;add_config_js=path.isAbsolute(config_js)?`${paths.dir}/${paths.name}-${config.runmode}${paths.ext}`:`${root_dir}/.genie/${paths.dir}/${paths.name}-${config.runmode}${paths.ext}`;try{fs.accessSync(add_config_js),eval(fs.readFileSync(add_config_js).toString())}catch(e){}return d(config.core.docker.name),config}),isWindows=module.exports.isWindows=(()=>"win32"===process.platform),isMac=module.exports.isMac=(()=>"darwin"===process.platform),hasDockerMachineEnv=module.exports.hasDockerMachineEnv=(()=>{return 0===child.spawnSync("docker-machine").status}),Error=module.exports.Error=(e=>{console.log(),Message(`エラーが発生しました。\n${e}`,"danger",1),Say("エラーが発生しました"),process.exit()}),dockerDown=module.exports.dockerDown=((e,o)=>new Promise((r,t)=>{let s=existContainers(o,e);s||r();let n=[];var l=!0,p=!1,a=void 0;try{for(var c,i=s[Symbol.iterator]();!(l=(c=i.next()).done);l=!0){let e=c.value;n.push(new Promise((o,r)=>{child.spawn("docker",["rm","-f",e.id]).stderr.on("data",o=>{console.log(color.blackBright(`  [Container] ${e.name} (${e.id}) ... `)+color.red("delete NG!")),r(o)}).on("close",r=>{console.log(color.blackBright(`  [Container] ${e.name} (${e.id}) ... `)+color.green("deleted")),o()})}))}}catch(e){p=!0,a=e}finally{try{!l&&i.return&&i.return()}finally{if(p)throw a}}Promise.all(n).catch(e=>{Error(e)}).then(()=>{r()})})),dockerUpMySQL=module.exports.dockerUpMySQL=((e,o)=>new Promise((r,t)=>{let s=o.db.mysql[e],n=`${o.base_name}-mysql-${e}`,l=[];l.push("run","-d","-it"),l.push("-e","TERM=xterm-256color"),l.push("--name",n),l.push("--label",`genie_runmode="${o.runmode}"`),l.push("--label",`genie_root="${o.root}"`),l.push("-v",`${o.root}/.genie/files/opt/mysql/:/opt/mysql/`),l.push("-v",`${s.volume_lock?"locked_":""}${n}:/var/lib/mysql`),l.push("-e",`MYSQL_LABEL=${e}`),l.push("-e",`MYSQL_ROOT_PASSWORD=${s.pass}`),l.push("-e",`MYSQL_DATABASE=${s.name}`),l.push("-e",`MYSQL_USER=${s.user}`),l.push("-e",`MYSQL_PASSWORD=${s.pass}`),l.push("-e",`MYSQL_CHARSET=${s.charset}`),o.core.docker.network&&l.push(`--net=${o.core.docker.network}`),o.core.docker.options&&l.push(`${o.core.docker.options}`),s.external_port&&l.push("-p","auto"===s.external_port?"3306":`${s.external_port}:3306`),l.push("--entrypoint=/opt/mysql/before-entrypoint.sh"),l.push("--restart=always"),l.push(s.repository),l.push("mysqld"),s.charset&&l.push(`--character-set-server=${s.charset}`),s.collation&&l.push(`--collation-server=${s.collation}`),child.spawn("docker",l).stderr.on("data",e=>{e.toString().match(/Unable to find image '.+' locally/)&&(process.env[`DOCKER_IMAGE_DOWN_LOADING_${n.toUpperCase()}`]=!0)}).on("close",e=>{delete process.env[`DOCKER_IMAGE_DOWN_LOADING_${n.toUpperCase()}`],r()})})),dockerUpPostgreSQL=module.exports.dockerUpPostgreSQL=((e,o)=>new Promise((r,t)=>{let s=o.db.postgresql[e],n=`${o.base_name}-postgresql-${e}`,l=[];l.push("run","-d","-it"),l.push("-e","TERM=xterm-256color"),l.push("--name",n),l.push("--label",`genie_runmode="${o.runmode}"`),l.push("--label",`genie_root="${o.root}"`),l.push("-v",`${o.root}/.genie/files/opt/postgresql/:/opt/postgresql/`),l.push("-v",`${s.volume_lock?"locked_":""}${n}:/var/lib/postgresql/data`),l.push("-e",`POSTGRES_LABEL=${e}`),l.push("-e",`POSTGRES_HOST=${s.host}`),l.push("-e",`POSTGRES_DB=${s.name}`),l.push("-e",`POSTGRES_USER=${s.user}`),l.push("-e",`POSTGRES_PASSWORD=${s.pass}`),l.push("-e",`POSTGERS_ENCODING=${s.encoding}`),l.push("-e",`POSTGERS_LOCALE=${s.locale}`),o.core.docker.network&&l.push(`--net=${o.core.docker.network}`),o.core.docker.options&&l.push(`${o.core.docker.options}`),s.external_port&&l.push("-p","auto"===s.external_port?"5432":`${s.external_port}:5432`),l.push("--entrypoint=/opt/postgresql/before-entrypoint.sh"),l.push("--restart=always"),l.push(s.repository),l.push("postgres"),child.spawn("docker",l).stderr.on("data",e=>{e.toString().match(/Unable to find image '.+' locally/)&&(process.env[`DOCKER_IMAGE_DOWN_LOADING_${n.toUpperCase()}`]=!0)}).on("close",e=>{delete process.env[`DOCKER_IMAGE_DOWN_LOADING_${n.toUpperCase()}`],r()})})),dockerUp=module.exports.dockerUp=(e=>new Promise((o,r)=>{let t=[];if(t.push("run","-d","-it"),t.push("-e","TERM=xterm-256color"),t.push("-e","LANG=ja_JP.UTF-8"),t.push("-e","LC_ALL=ja_JP.UTF-8"),t.push("-v",e.root+"/.genie/files/opt:/opt"),t.push("--label",`genie_runmode="${e.runmode}"`),t.push("--label",`genie_root="${e.root}"`),t.push(`--name=${e.base_name}`),e.core.docker.network&&t.push(`--net=${e.core.docker.network}`),e.core.docker.options&&t.push(`${e.core.docker.options}`),t.push("--restart=always"),e.lang.perl.cpanfile_enabled&&t.push("-e","PERL5LIB=/perl/cpanfile-modules/lib/perl5"),e.db.postgresql){let o=Object.keys(e.db.postgresql);for(let r=0;r<o.length;r++){let s=`${e.base_name}-postgresql-${o[r]}`;t.push("--link",s),t.push("--add-host",e.db.postgresql[o[r]].host+":"+getContainerIp(s,e))}}if(e.db.mysql){let o=Object.keys(e.db.mysql);for(let r=0;r<o.length;r++){let s=`${e.base_name}-mysql-${o[r]}`;t.push("--link",s),t.push("--add-host",e.db.mysql[o[r]].host+":"+getContainerIp(s,e))}}if(e.trans.sshd&&e.trans.sshd.enabled&&e.trans.sshd.external_port&&t.push("-p","auto"===e.trans.sshd.external_port?"22":`${e.trans.sshd.external_port}:22`),e.http.apache&&e.http.apache.enabled&&(t.push("-v",`${e.root}/${e.http.apache.public_dir}:/var/www/html`),e.http.apache.external_http_port&&t.push("-p","auto"===e.http.apache.external_http_port?"80":`${e.http.apache.external_http_port}:80`),e.http.apache.external_https_port&&t.push("-p","auto"===e.http.apache.external_https_port?"443":`${e.http.apache.external_https_port}:443`)),e.http.nginx&&e.http.nginx.enabled&&(t.push("-v",`${e.root}/${e.http.nginx.public_dir}:/usr/share/nginx/html`),e.http.nginx.external_http_port&&t.push("-p","auto"===e.http.nginx.external_http_port?"80":`${e.http.nginx.external_http_port}:80`),e.http.nginx.external_https_port&&t.push("-p","auto"===e.http.nginx.external_https_port?"443":`${e.http.nginx.external_https_port}:443`)),e.mail.sendlog&&e.mail.sendlog.enabled&&e.mail.sendlog.external_port&&t.push("-p","auto"===e.mail.sendlog.external_port?"9981":`${e.mail.sendlog.external_port}:9981`),e.log.fluentd&&t.push("-v",`${e.root}/.genie/files/opt/td-agent:/etc/td-agent`),e.core.docker.hosts&&Array.isArray(e.core.docker.hosts)&&e.core.docker.hosts.length)for(let o=0;o<e.core.docker.hosts.length;o++)t.push(`--add-host=${e.core.docker.hosts[o]}`);if(t.push("-v",`${e.root}/:/mnt/host/`),e.core.docker.mounts&&Array.isArray(e.core.docker.mounts)&&e.core.docker.mounts.length)for(let o=0;o<e.core.docker.mounts.length;o++)e.core.docker.mounts[o].match(/^\//)?t.push("-v",`${e.core.docker.mounts[o]}`):t.push("-v",`${e.root}/${e.core.docker.mounts[o]}`);let s={},n=(e,o)=>{if("object"!=typeof e||Array.isArray(e))"object"==typeof e&&Array.isArray(e)?s[o]=JSON.stringify(e):s[o]=e;else{let r=Object.keys(e);for(let t=0;t<r.length;t++)n(e[r[t]],`${o}_${r[t].toUpperCase()}`)}};n(e,"GENIE"),s.GENIE_RUNMODE=e.runmode;let l=Object.keys(s);for(let e=0;e<l.length;e++)t.push("-e",`${l[e]}=${s[l[e]]}`);t.push(e.core.docker.image);let p=child.spawnSync("docker",t);p.status?r(p.stderr.toString()):o()})),existContainers=module.exports.existContainers=((e,o)=>{let r=["--filter",`label=genie_root="${e.root}"`,"--filter",`label=genie_runmode="${e.runmode}"`];o&&r.push("--filter",`name=${o}`);let t=child.spawnSync("docker",["ps","-a","--format","{{.ID}}\t{{.Names}}",...r]);t.status&&Error(t.stderr.toString());let s=[];var n=!0,l=!1,p=void 0;try{for(var a,c=t.stdout.toString().split(/\n/)[Symbol.iterator]();!(n=(a=c.next()).done);n=!0){let e=a.value.split(/\t+/);e[0]&&s.push({id:e[0],name:e[1]})}}catch(e){l=!0,p=e}finally{try{!n&&c.return&&c.return()}finally{if(l)throw p}}return!!s.length&&s}),getContainerIp=module.exports.getContainerIp=((e,o)=>{try{let r;if(!(r=o.core.docker.network?child.spawnSync("docker",["inspect",`--format={{.NetworkSettings.Networks.${o.core.docker.network}.IPAddress}}`,e]):child.spawnSync("docker",["inspect","--format={{.NetworkSettings.IPAddress}}",e])).stderr.toString())return r.stdout.toString().replace(/[\r\n]$/,"");Error(r.stderr.toString())}catch(e){Error(e)}}),sleep=module.exports.sleep=(e=>new Promise(o=>{setTimeout(o,e)}));
},{}],5:[function(require,module,exports) {
"use strict";function e(e){return function(){var n=e.apply(this,arguments);return new Promise(function(e,t){return function s(r,o){try{var a=n[r](o),i=a.value}catch(e){return void t(e)}if(!a.done)return Promise.resolve(i).then(function(e){s("next",e)},function(e){s("throw",e)});e(i)}("next")})}}const n=require("./libs.js"),t=n.d,s=n.h;module.exports=(()=>{var t=e(function*(e){console.log(),n.Message("サンプル：default","default"),n.Message("サンプル：primary","primary"),n.Message("サンプル：success","success"),n.Message("サンプル：danger","danger"),n.Message("サンプル：warning","warning"),n.Message("サンプル：info","info"),n.Message("改行込み、1ライン入れも可能。\ntest1\ntest2\ntest3","default",1);let t=yield n.Input("入力BOX（入力文字を発音しますのでご注意）：",20);n.Message("入力された文字："+t),n.Say(t);try{throw new Error("エラーテスト（終了コード255）")}catch(e){console.log(e),process.exit(255)}process.exit()});return function(e){return t.apply(this,arguments)}})();
},{"./libs.js":3}],7:[function(require,module,exports) {
"use strict";const e=require("./libs.js"),s=e.d,i=e.h,o=require("child_process");module.exports=(i=>{let c=i.usage("Usage: genie|g config [Options]").options("dump",{alias:"d",describe:"設定値を確認します。"}).argv;c.help&&(console.log(),e.Message(i.help(),"primary",1),process.exit());let r=e.loadConfig(c);if(c.dump)s(r);else{let s=`${e.getRootDir()}/.genie/${c.config}`;e.isWindows()?o.execSync(`start ${s}`):e.isMac()&&o.execSync(`open ${s}`)}process.exit()});
},{"./libs.js":3}],9:[function(require,module,exports) {
"use strict";const t=require("./libs.js"),e=t.d,s=t.h,r=require("child_process"),o=require("cli-color"),i=require("cliui")({width:o.windowSize.width-4});module.exports=(e=>{t.showRunmode();let s=e.usage("Usage: genie|g ls [Options]").options("long",{alias:"l",describe:"コンテナ一覧がもうちょっとだけ詳細に出ます"}).argv;if(s.help&&(console.log(),t.Message(e.help(),"primary",1),process.exit()),t.hasDockerMachineEnv()){console.log("\n  DockeMachines");let e=r.spawnSync("docker-machine",["ls"]);e.status&&t.Error(e.stderr.toString()),t.Message(e.stdout.toString(),"primary",1)}{console.log("\n  Images");let e=r.spawnSync("docker",["images"]);e.status&&t.Error(e.stderr.toString()),t.Message(e.stdout.toString(),"primary",1)}{console.log("\n  Volumes");let e=r.spawnSync("docker",["volume","ls","--format","table {{.Name}}\t{{.Driver}}\t{{.Scope}}"]);e.status&&t.Error(e.stderr.toString()),t.Message(e.stdout.toString(),"primary",1)}{console.log("\n  Containers");let e=["--format","{{.Names}}\t{{.ID}}\t{{.Image}}\t{{.Status}}\t{{.Ports}}"],o=["NAMES","ID","IMAGE","STATUS","PORTS"];s.long&&(e=["--format","{{.Names}}\t{{.ID}}\t{{.Image}}\t{{.Command}}\t{{.CreatedAt}}\t{{.Status}}\t{{.Ports}}\t{{.Labels}}"],o=["NAMES","ID","IMAGE","COMMAND","CREATED","STATUS","PORTS","LABELS"]);let n=r.spawnSync("docker",["ps","-a",...e]);n.status&&t.Error(n.stderr.toString());let a=n.stdout.toString().trim().split("\n");a.unshift(o.join("\t"));for(let t in a){let e=a[t].split(/\t/),r=[];for(let t in e){let o;s.long?(6==t&&(o=30),7==t&&(o=50)):4==t&&(o=30),r.push({text:e[t].replace(/, ?/g,"\n"),width:o,padding:[0,1,0,1]})}i.div(...r)}t.Message(i.toString(),"primary",1)}process.exit()});
},{"./libs.js":3}],11:[function(require,module,exports) {
"use strict";function e(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,r){return function n(o,s){try{var l=t[o](s),a=l.value}catch(e){return void r(e)}if(!l.done)return Promise.resolve(a).then(function(e){n("next",e)},function(e){n("throw",e)});e(a)}("next")})}}const t=require("./libs.js"),r=t.d,n=t.h,o=require("child_process"),s=require("cli-color");module.exports=(r=>{let l=r.usage("Usage: genie|g up [Options]").argv;l.help&&(console.log(),t.Message(r.help(),"primary",1),process.exit());let a=t.loadConfig(l);try{let e=a.core.memo.up;e&&t.Messages(e)}catch(e){Error("メモの設定が異常です。")}e(function*(){t.existContainers(a)&&(yield Promise.all([t.dockerDown(null,a)]).catch(function(e){return e}));let e=[];if(a.db.postgresql){var r=!0,l=!1,i=void 0;try{for(var u,c=Object.keys(a.db.postgresql)[Symbol.iterator]();!(r=(u=c.next()).done);r=!0){let r=u.value;e.push(t.dockerUpPostgreSQL(r,a))}}catch(e){l=!0,i=e}finally{try{!r&&c.return&&c.return()}finally{if(l)throw i}}}if(a.db.mysql){var p=!0,h=!1,y=void 0;try{for(var d,m=Object.keys(a.db.mysql)[Symbol.iterator]();!(p=(d=m.next()).done);p=!0){let r=d.value;e.push(t.dockerUpMySQL(r,a))}}catch(e){h=!0,y=e}finally{try{!p&&m.return&&m.return()}finally{if(h)throw y}}}Promise.all(e).catch(function(e){t.Error(e)}).then(function(){return t.dockerUp(a).catch(function(e){return t.Error(e)})}),console.log();let f,g=0,b=[];do{if(f=[],a.db.postgresql&&Object.keys(a.db.postgresql).length){var $=!0,v=!1,w=void 0;try{for(var x,_=Object.keys(a.db.postgresql)[Symbol.iterator]();!($=(x=_.next()).done);$=!0){let e=x.value,t=`${a.base_name}-postgresql-${e}`,r=o.spawnSync("docker",["exec",t,"sh","-c","ps aux|grep entrypoint.sh|grep -v grep|wc -l"]);-1!==b.indexOf(t)||"0"===r.stdout.toString().trim()?(f.push(`  ${t} ... ${s.green("ready!")}`),-1===b.indexOf(t)&&b.push(t)):f.push(`  ${t} ... ${s.yellow("loading")}`)}}catch(e){v=!0,w=e}finally{try{!$&&_.return&&_.return()}finally{if(v)throw w}}}if(a.db.mysql&&Object.keys(a.db.mysql).length){var O=!0,q=!1,S=void 0;try{for(var P,k=Object.keys(a.db.mysql)[Symbol.iterator]();!(O=(P=k.next()).done);O=!0){let e=P.value,t=`${a.base_name}-mysql-${e}`,r=o.spawnSync("docker",["logs",t]);-1!==b.indexOf(t)||r.stdout.toString().match(/MySQL Community Server \(GPL\)/)?(f.push(`  ${t} ... ${s.green("ready!")}`),-1===b.indexOf(t)&&b.push(t)):process.env[`DOCKER_IMAGE_DOWN_LOADING_${t.toUpperCase()}`]?f.push(`  ${t} ... ${s.yellow("image downloading")}`):f.push(`  ${t} ... ${s.yellow("loading")}`)}}catch(e){q=!0,S=e}finally{try{!O&&k.return&&k.return()}finally{if(q)throw S}}}let e=o.spawnSync("docker",["exec",a.base_name,"cat","/var/log/entrypoint.log"]).stdout.toString();-1!==b.indexOf(a.base_name)||e.match(/entrypoint\.sh setup done\./)?(-1===b.indexOf(a.base_name)&&b.push(a.base_name),f.push(`  ${a.base_name} ... ${s.green("ready!")}`)):e.match(/init\.sh setup done\./)?f.push(`  ${a.base_name} ... ${s.yellow("init.sh setup")}`):e.match(/Postfix setup done\./)?f.push(`  ${a.base_name} ... ${s.yellow("Postfix setup")}`):e.match(/Nginx setup done\./)?f.push(`  ${a.base_name} ... ${s.yellow("Nginx setup")}`):e.match(/Apache setup done\./)?f.push(`  ${a.base_name} ... ${s.yellow("Apache setup")}`):e.match(/Node.js setup done\./)?f.push(`  ${a.base_name} ... ${s.yellow("Node.js setup")}`):e.match(/Ruby setup done\./)?f.push(`  ${a.base_name} ... ${s.yellow("Ruby setup")}`):e.match(/PHP setup done\./)?f.push(`  ${a.base_name} ... ${s.yellow("PHP setup")}`):e.match(/Perl setup done\./)?f.push(`  ${a.base_name} ... ${s.yellow("Perl setup")}`):e.match(/entrypoint\.sh setup start\./)?f.push(`  ${a.base_name} ... ${s.yellow("loading")}`):f.push(`  ${a.base_name} ... ${s.yellow("waiting")}`),g++&&process.stdout.write(s.move.up(f.length));var j=!0,N=!1,C=void 0;try{for(var E,L=f[Symbol.iterator]();!(j=(E=L.next()).done);j=!0){let e=E.value;process.stdout.write(s.erase.line),console.log(e)}}catch(e){N=!0,C=e}finally{try{!j&&L.return&&L.return()}finally{if(N)throw C}}b.length!==f.length&&(yield t.sleep(100))}while(b.length!==f.length);n("起動完了!!"),process.exit()})()});
},{"./libs.js":3}],13:[function(require,module,exports) {
"use strict";function e(e){return function(){var n=e.apply(this,arguments);return new Promise(function(e,r){return function t(o,i){try{var s=n[o](i),c=s.value}catch(e){return void r(e)}if(!s.done)return Promise.resolve(c).then(function(e){t("next",e)},function(e){t("throw",e)});e(c)}("next")})}}const n=require("./libs.js"),r=n.d,t=n.h,o=require("child_process");module.exports=(r=>{let o=r.usage("Usage: genie|g down [Options]").argv;o.help&&(console.log(),n.Message(r.help(),"primary",1),process.exit());let i=n.loadConfig(o);try{let e=i.core.memo.down;e&&n.Messages(e)}catch(e){Error("メモの設定が異常です。")}e(function*(){yield Promise.all([n.dockerDown(null,i)]).catch(function(e){return e}).then(function(){t("DONE!"),process.exit()})})()});
},{"./libs.js":3}],15:[function(require,module,exports) {
"use strict";const e=require("./libs.js"),s=e.d,o=e.h,r=require("child_process");module.exports=(s=>{let o=s.usage("Usage: genie|g cli [Options] [Commands]").options("host",{describe:"実行するホスト名を指定する"}).argv;o.help&&(console.log(),e.Message(s.help(),"primary",1),process.exit());let t=e.loadConfig(o),i=o.host?o.host:t.core.docker.name,c=process.argv.slice(process.argv.findIndex(e=>e===o._[1]));if(e.existContainers(t,"/"+i+"$")||e.Error("dockerコンテナが起動していません: "+i),1!==o._.length){let s=r.spawnSync("docker",["exec",i,...c]);s.status&&(e.Error(s.stderr.toString()||s.stdout.toString()),process.exit()),console.log(s.stdout.toString()),process.exit()}else r.spawnSync("docker",["exec","-it",i,"bash"],{stdio:"inherit"}),process.exit()});
},{"./libs.js":3}],17:[function(require,module,exports) {
"use strict";function e(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,r){return function o(n,l){try{var i=t[n](l),s=i.value}catch(e){return void r(e)}if(!i.done)return Promise.resolve(s).then(function(e){o("next",e)},function(e){o("throw",e)});e(s)}("next")})}}const t=require("./libs.js"),r=t.d,o=t.h,n=require("child_process"),l=require("inquirer"),i=require("cli-color");module.exports=(r=>{let s=r.usage("Usage: genie|g reject [Options]").options("force",{alias:"f",describe:"選択肢を出さずにすぐに削除を開始する"}).options("locked",{alias:"l",describe:"「locked_」から始まるボリューム・コンテナも対象にする"}).argv;s.help&&(console.log(),t.Message(r.help(),"primary",1),process.exit());let c=[],a=n.spawnSync("docker",["ps","-qa","--format","{{.Names}}\t{{.Status}}"]);a.status&&t.Error(a.stderr.toString());var u=!0,d=!1,f=void 0;try{for(var h,m=a.stdout.toString().trim().split(/\n/)[Symbol.iterator]();!(u=(h=m.next()).done);u=!0){let e=h.value;if(!e)continue;let t=e.split(/\t/),r=t[0],o=(t[1],r.match(/^locked_/)),n=`[Container] ${r}`;o&&(n=i.blackBright(n)),c.push({name:n,checked:!(o&&!s.locked)})}}catch(e){d=!0,f=e}finally{try{!u&&m.return&&m.return()}finally{if(d)throw f}}let p=[];(a=n.spawnSync("docker",["volume","ls","--format","{{.Name}}\t{{.Driver}}"])).status&&t.Error(a.stderr.toString());var y=!0,v=!1,g=void 0;try{for(var w,k=a.stdout.toString().trim().split(/\n/)[Symbol.iterator]();!(y=(w=k.next()).done);y=!0){let e=w.value;if(!e)continue;let t=e.split(/\t/),r=t[0],o=(t[1],r.match(/^locked_/)),n=`[Volume] ${r}`;o&&(n=i.blackBright(n)),p.push({name:n,checked:!(o&&!s.locked)})}}catch(e){v=!0,g=e}finally{try{!y&&k.return&&k.return()}finally{if(v)throw g}}let x=c.length+p.length;0===x&&(o("対象のオブジェクトはありませんでした。"),process.exit()),e(function*(){let e;if(s.force){let t=[...c,...p];(e={}).rejects=[];var r=!0,o=!1,a=void 0;try{for(var u,d=t[Symbol.iterator]();!(r=(u=d.next()).done);r=!0){let t=u.value;t.checked&&e.rejects.push(t.name)}}catch(e){o=!0,a=e}finally{try{!r&&d.return&&d.return()}finally{if(o)throw a}}}else{console.log(),(e=yield l.prompt([{type:"checkbox",message:"削除したいものにチェックを入れて Enter してください。",name:"rejects",pageSize:100,choices:[...c,...p]}])).rejects.length||process.exit(),process.stdout.write(i.move.up(x));for(let e=0;e<x;e++)process.stdout.write(i.erase.line),process.stdout.write(i.move.down(1));process.stdout.write(i.move.up(x))}let f=[],h=[];var m=!0,y=!1,v=void 0;try{for(var g,w=e.rejects[Symbol.iterator]();!(m=(g=w.next()).done);m=!0){let e=g.value,t=(e=i.strip(e)).match(/^\[(Container|Volume)\] (.+)$/);"Container"===t[1]?h.push(t[2]):"Volume"===t[1]&&f.push(t[2])}}catch(e){y=!0,v=e}finally{try{!m&&w.return&&w.return()}finally{if(y)throw v}}console.log();let k=[];var S=!0,b=!1,$=void 0;try{for(var j,q=h[Symbol.iterator]();!(S=(j=q.next()).done);S=!0){let e=j.value;k.push(new Promise(function(t,r){n.spawn("docker",["rm","-fv",e]).stderr.on("data",function(t){console.log(`  [Container] ${e} - ${i.red("ng")}`),r(t)}).on("close",function(r){console.log(`  [Container] ${e} - ${i.green("deleted")}`),t()})}))}}catch(e){b=!0,$=e}finally{try{!S&&q.return&&q.return()}finally{if(b)throw $}}yield Promise.all(k).catch(function(e){t.Error(e)}),k=[];var P=!0,C=!1,E=void 0;try{for(var V,_=f[Symbol.iterator]();!(P=(V=_.next()).done);P=!0){let e=V.value;k.push(new Promise(function(t,r){n.spawn("docker",["volume","rm","-f",e]).stderr.on("data",function(t){console.log(`  [Volume] ${e} - ${i.red("ng")}`),r(t)}).on("close",function(r){console.log(`  [Volume] ${e} - ${i.green("deleted")}`),t()})}))}}catch(e){C=!0,E=e}finally{try{!P&&_.return&&_.return()}finally{if(C)throw E}}yield Promise.all(k).catch(function(e){t.Error(e)}),process.exit()})()});
},{"./libs.js":3}],19:[function(require,module,exports) {
"use strict";function r(r){return function(){var e=r.apply(this,arguments);return new Promise(function(r,t){return function o(n,i){try{var l=e[n](i),s=l.value}catch(r){return void t(r)}if(!l.done)return Promise.resolve(s).then(function(r){o("next",r)},function(r){o("throw",r)});r(s)}("next")})}}const e=require("./libs.js"),t=e.d,o=e.h,n=require("child_process"),i=require("cli-color");module.exports=(t=>{let l,s,c=t.usage("Usage: genie|g clean [Options]").options("force",{alias:"f",describe:"lockedから始まる名前も対象にする"}).argv;c.help&&(console.log(),e.Message(t.help(),"primary",1),process.exit());let a,u=0;r(function*(){a=[],l=["ps","-qa","--filter","exited=0","--format","{{.Names}}"],(s=n.spawnSync("docker",l)).status&&e.Error(s.stderr.toString());var r=!0,t=!1,d=void 0;try{for(var f,m=s.stdout.toString().trim().split(/\n/)[Symbol.iterator]();!(r=(f=m.next()).done);r=!0){let r=f.value;r&&(!c.f&&r.match(/^locked_/i)||a.push(new Promise(function(e,t){u++||console.log(),n.spawn("docker",["rm","-fv",r]).stderr.on("data",function(r){return t(r)}).on("close",function(t){console.log(`  [Container] ${r} - ${i.green("deleted")}`),e()})})))}}catch(r){t=!0,d=r}finally{try{!r&&m.return&&m.return()}finally{if(t)throw d}}yield Promise.all(a).catch(function(r){e.Error(r)}),a=[],l=["volume","ls","--filter","dangling=true","--format","{{.Name}}"],(s=n.spawnSync("docker",l)).status&&e.Error(s.stderr.toString());var g=!0,p=!1,y=void 0;try{for(var h,v=s.stdout.toString().trim().split(/\n/)[Symbol.iterator]();!(g=(h=v.next()).done);g=!0){let r=h.value;r&&(!c.f&&r.match(/^locked_/i)||a.push(new Promise(function(e,t){u++||console.log(),n.spawn("docker",["volume","rm","-f",r]).stderr.on("data",function(r){return t(r)}).on("close",function(t){console.log(`  [Volume] ${r} - ${i.green("deleted")}`),e()})})))}}catch(r){p=!0,y=r}finally{try{!g&&v.return&&v.return()}finally{if(p)throw y}}yield Promise.all(a).catch(function(r){e.Error(r)}),l=["images","-q","--filter","dangling=true"],(s=n.spawnSync("docker",l)).status&&e.Error(s.stderr.toString());var w=!0,S=!1,k=void 0;try{for(var x,P=s.stdout.toString().trim().split(/\n/)[Symbol.iterator]();!(w=(x=P.next()).done);w=!0){let r=x.value;r&&a.push(new Promise(function(e,t){u++||console.log(),n.spawn("docker",["rmi",r]).stderr.on("data",function(r){return t(r)}).on("close",function(t){console.log(`  [Image] ${r} - ${i.green("deleted")}`),e()})}))}}catch(r){S=!0,k=r}finally{try{!w&&P.return&&P.return()}finally{if(S)throw k}}yield Promise.all(a).catch(function(r){e.Error(r)}),u||o("対象のオブジェクトはありませんでした。"),process.exit()})()});
},{"./libs.js":3}],21:[function(require,module,exports) {
"use strict";function e(e){return function(){var o=e.apply(this,arguments);return new Promise(function(e,n){return function t(r,i){try{var c=o[r](i),s=c.value}catch(e){return void n(e)}if(!c.done)return Promise.resolve(s).then(function(e){t("next",e)},function(e){t("throw",e)});e(s)}("next")})}}const o=require("./libs.js"),n=o.d,t=o.h,r=require("child_process"),i=require("cli-color");module.exports=(n=>{let t=n.usage("Usage: genie|g build [Options]").options("no-cache",{alias:"n",describe:"キャッシュを使用せずにビルドする"}).argv;t.help&&(console.log(),o.Message(n.help(),"primary",1),process.exit());let c=o.loadConfig(t);e(function*(){if((yield o.Input(`${c.core.docker.image} イメージをビルドしてもよろしいでしょうか。[y/N]: `)).match(/^y$/i)){let e=["build","-t",c.core.docker.image];t["no-cache"]&&e.push("--no-cache"),e.push(`${o.getRootDir()}/.genie/image/`),o.Message(`ビルドを開始します。\ndocker ${e.join(" ")}`,"info"),console.log();let n=r.spawn("docker",e);n.stdout.on("data",function(e){console.log(i.blackBright(e.toString().trim()))}),n.stderr.on("data",function(e){o.Error(e),process.exit()}),n.on("close",function(e){let n="ビルドが完了しました。";o.Message(n),o.Say(n),process.exit()})}})()});
},{"./libs.js":3}],23:[function(require,module,exports) {
"use strict";const e=require("./libs.js"),n=e.d,i=e.h,s=require("child_process");module.exports=(n=>{let i=n.usage("Usage: genie|g langver [Options]").options("php",{describe:"PHPの利用可能なバージョン一覧を表示"}).options("perl",{describe:"Perlの利用可能なバージョン一覧を表示"}).options("ruby",{describe:"Rubyの利用可能なバージョン一覧を表示"}).options("node",{describe:"Node.jsの利用可能なバージョン一覧を表示"}).argv;if(i.help&&(console.log(),e.Message(n.help(),"primary",1),process.exit()),i.php){let n=s.spawnSync("docker",["run","--rm","--entrypoint=bash","kazaoki/genie","-c","/root/.anyenv/envs/phpenv/plugins/php-build/bin/php-build --definitions"]);e.Message(n.stdout.toString(),"primary")}else if(i.perl){let n=s.spawnSync("docker",["run","--rm","--entrypoint=bash","kazaoki/genie","-c","/root/.anyenv/envs/plenv/plugins/perl-build/perl-build  --definitions"]);e.Message(n.stdout.toString(),"primary")}else if(i.ruby){let n=s.spawnSync("docker",["run","--rm","--entrypoint=bash","kazaoki/genie","-c","/root/.anyenv/envs/rbenv/plugins/ruby-build/bin/ruby-build  --definitions"]);e.Message(n.stdout.toString(),"primary")}else if(i.node){let n=s.spawnSync("docker",["run","--rm","--entrypoint=bash","kazaoki/genie","-c","/root/.anyenv/envs/ndenv/plugins/node-build/bin/node-build  --definitions"]);e.Message(n.stdout.toString(),"primary")}else console.log(),e.Message(n.help(),"primary",1);process.exit()});
},{"./libs.js":3}],25:[function(require,module,exports) {
"use strict";function e(e){return function(){var r=e.apply(this,arguments);return new Promise(function(e,s){return function t(n,l){try{var i=r[n](l),o=i.value}catch(e){return void s(e)}if(!i.done)return Promise.resolve(o).then(function(e){t("next",e)},function(e){t("throw",e)});e(o)}("next")})}}const r=require("./libs.js"),s=r.d,t=r.h,n=require("child_process"),l=require("inquirer"),i=require("fs");function o(s,t={}){return 1===Object.keys(s.db.mysql).length?`${s.base_name}-mysql-${Object.keys(s.db.mysql)[0]}`:e(function*(){let e=[];var n=!0,i=!1,o=void 0;try{for(var a,y=Object.keys(s.db.mysql)[Symbol.iterator]();!(n=(a=y.next()).done);n=!0){let r=a.value;e.push(`${r} (${s.base_name}-mysql-${r})`)}}catch(e){i=!0,o=e}finally{try{!n&&y.return&&y.return()}finally{if(i)throw o}}t.has_all&&e.push("全て"),console.log();let c=yield l.prompt([{type:"list",message:"対象のMySQLコンテナを選択してください。",name:"container",pageSize:100,choices:e}]).catch(function(e){r.Error(e)});if("全て"===c.container)return t.is_key_return?Object.keys(s.db.mysql):Object.keys(s.db.mysql).map(function(e){return`${s.base_name}-mysql-${e}`});{let e=c.container.match(/^(\w+) /);return t.is_key_return?e[1]:`${s.base_name}-mysql-${e[1]}`}})()}function a(e,r){let s;var t=!0,n=!1,l=void 0;try{for(var i,o=Object.keys(e.db.mysql)[Symbol.iterator]();!(t=(i=o.next()).done);t=!0){let t=i.value;if(r===`${e.base_name}-mysql-${t}`){s=t;break}}}catch(e){n=!0,l=e}finally{try{!t&&o.return&&o.return()}finally{if(n)throw l}}return s}module.exports=(t=>{let l=t.usage("Usage: genie|g mysql [Options]").options("cli",{alias:"c",describe:"MySQLコンテナのCLIに入る",boolean:!0}).options("dump",{alias:"d",describe:"MySQLのダンプを取る",boolean:!0}).options("restore",{alias:"r",describe:"MySQLのリストアを行う",boolean:!0}).options("all",{alias:"a",describe:"管轄全てのMySQLを対象とする（--dump, --restoreのみ）",boolean:!0}).argv;l.help&&(console.log(),r.Message(t.help(),"primary",1),process.exit());let y=r.loadConfig(l);y.db.mysql&&Object.keys(y.db.mysql).length||r.Error("MySQL設定がありません。"),r.existContainers(y,"/"+y.base_name+"$")||r.Error("dockerコンテナが起動していません: "+y.base_name),e(function*(){if(l.cli){let e=l._[1]?`${y.base_name}-mysql-${l._[1]}`:yield o(y,{is_single:!0});a(y,e);n.spawnSync("docker",["exec","-it",e,"bash"],{stdio:"inherit"}),process.exit()}else if(l.dump){l._.shift();let n=l.all?Object.keys(y.db.mysql):l._.length?l._:yield o(y,{has_all:!0,is_key_return:!0});Array.isArray(n)||(n=[n]);let a=`${y.root}/.genie/files/opt/mysql/dumps`;i.existsSync(a)||i.mkdirSync(a,493);var e=!0,t=!1,c=void 0;try{for(var m,u=n[Symbol.iterator]();!(e=(m=u.next()).done);e=!0){let e=m.value;y.db.mysql[e]||r.Error("指定のキーのMySQL設定が定義されていません。"+e),s(e)}}catch(e){t=!0,c=e}finally{try{!e&&u.return&&u.return()}finally{if(t)throw c}}process.exit()}else if(l.restore){s("RESTORE");let e=yield o(y,{has_all:!0});s(e),process.exit()}else{let e=l._[1]?`${y.base_name}-mysql-${l._[1]}`:yield o(y,{is_single:!0}),s=a(y,e);y.db.mysql[s]||r.Error("指定のキーのMySQL設定が定義されていません。"+s),n.spawnSync("docker",["exec","-it",e,"mysql",y.db.mysql[s].name,`-u${y.db.mysql[s].user}`,`-p${y.db.mysql[s].pass}`],{stdio:"inherit"}),process.exit()}})()});
},{"./libs.js":3}],27:[function(require,module,exports) {
"use strict";function e(e){return function(){var r=e.apply(this,arguments);return new Promise(function(e,t){return function s(n,o){try{var i=r[n](o),l=i.value}catch(e){return void t(e)}if(!i.done)return Promise.resolve(l).then(function(e){s("next",e)},function(e){s("throw",e)});e(l)}("next")})}}const r=require("./libs.js"),t=r.d,s=r.h,n=require("child_process"),o=require("inquirer");function i(t,s,n={}){return s.name?n.is_single&&Array.isArray(s.name)?s.name[0]:s.name:1===Object.keys(t.db.postgresql).length?`${t.base_name}-postgresql-${Object.keys(t.db.postgresql)[0]}`:e(function*(){let e=[];var s=!0,i=!1,l=void 0;try{for(var a,c=Object.keys(t.db.postgresql)[Symbol.iterator]();!(s=(a=c.next()).done);s=!0){let r=a.value;e.push(`${r} (${t.base_name}-postgresql-${r})`)}}catch(e){i=!0,l=e}finally{try{!s&&c.return&&c.return()}finally{if(i)throw l}}n.has_all&&e.push("全て"),console.log();let p=yield o.prompt([{type:"list",message:"対象のPostgreSQLコンテナを選択してください。",name:"container",pageSize:100,choices:e}]).catch(function(e){r.Error(e)});if("全て"===p.container){let e=[];var u=!0,d=!1,g=void 0;try{for(var y,b=Object.keys(t.db.postgresql)[Symbol.iterator]();!(u=(y=b.next()).done);u=!0){let r=y.value;e.push(`${t.base_name}-postgresql-${r}`)}}catch(e){d=!0,g=e}finally{try{!u&&b.return&&b.return()}finally{if(d)throw g}}return e}{let e=p.container.match(/^(\w+) /);return`${t.base_name}-postgresql-${e[1]}`}})()}function l(e,r){let t;var s=!0,n=!1,o=void 0;try{for(var i,l=Object.keys(e.db.postgresql)[Symbol.iterator]();!(s=(i=l.next()).done);s=!0){let s=i.value;if(r===`${e.base_name}-postgresql-${s}`){t=s;break}}}catch(e){n=!0,o=e}finally{try{!s&&l.return&&l.return()}finally{if(n)throw o}}return t}module.exports=(s=>{let o=s.usage("Usage: genie|g psql [Options]").options("cli",{describe:"PostgreSQLコンテナのCLIに入る"}).options("dump",{alias:"d",describe:"PostgreSQLのダンプを取る"}).options("restore",{alias:"r",describe:"PostgreSQLのリストアを行う"}).options("name",{alias:"n",describe:"対象のPostgreSQLコンテナ名を直接指定する"}).argv;o.help&&(console.log(),r.Message(s.help(),"primary",1),process.exit());let a=r.loadConfig(o);a.db.postgresql&&Object.keys(a.db.postgresql).length||r.Error("PostgreSQL設定がありません。"),r.existContainers(a,"/"+a.base_name+"$")||r.Error("dockerコンテナが起動していません: "+a.base_name),e(function*(){if(o.cli){let e=yield i(a,o,{is_single:!0});l(a,e);n.spawnSync("docker",["exec","-it",e,"bash"],{stdio:"inherit"}),process.exit()}else if(o.dump){t("DUMP");let e=yield i(a,o,{has_all:!0});t(e),process.exit()}else if(o.restore){t("RESTORE");let e=yield i(a,o,{has_all:!0});t(e),process.exit()}else{let e=yield i(a,o,{is_single:!0}),r=l(a,e);n.spawnSync("docker",["exec","-it",e,"psql",a.db.postgresql[r].name,"-U",a.db.postgresql[r].user],{stdio:"inherit"}),process.exit()}})()});
},{"./libs.js":3}],29:[function(require,module,exports) {
"use strict";const e=require("./libs.js"),r=e.d,t=e.h,o=require("child_process"),s=require("cli-color");module.exports=(t=>{let s=t.usage("Usage: genie|g open [Options]").argv;s.help&&(console.log(),e.Message(t.help(),"primary",1),process.exit());let a,p=e.loadConfig(s);a=e.isWindows?"start":e.isWindows?"open":"xdg-open";let i="",h="https"===p.http.browser.schema?443:80,c=o.spawnSync("docker",["port",p.base_name,h]);c.status&&Error(c.stderr.toString());let l=c.stdout.toString().trim().match(/(\d+)$/)[1];l="http"===p.http.browser.schema&&80==l||"https"===p.http.browser.schema&&443==l?"":`:${l}`;let n=`${p.http.browser.schema}://${p.host_ip}${l}${p.http.browser.path}`;p.http.browser.apps&&p.http.browser.apps.length||(p.http.browser.apps=[""]);var f=!0,d=!1,m=void 0;try{for(var w,$=p.http.browser.apps[Symbol.iterator]();!(f=(w=$.next()).done);f=!0){i=w.value;let t="";e.isWindows()?"chrome"===i?t=" chrome":"firefox"===i?t=" firefox":"ie"===i?t=" explorer":"opera"===i?t=" opera":i&&(t=` ${i}`):"chrome"===i?t=" -a chrome":"firefox"===i?t=" -a firefox":"safari"===i?t=" -a safari":"opera"===i?t=" -a opera":i&&(t=` -a ${i}`),r(`${a}${t} ${n}`),o.execSync(`${a}${t} ${n}`)}}catch(e){d=!0,m=e}finally{try{!f&&$.return&&$.return()}finally{if(d)throw m}}process.exit()});
},{"./libs.js":3}],31:[function(require,module,exports) {
"use strict";const r=require("./libs.js"),e=r.d,t=r.h,o=require("child_process");module.exports=(e=>{let t=e.usage("Usage: genie|g logs [Options] [Commands]").argv;t.help&&(console.log(),r.Message(e.help(),"primary",1),process.exit());let l=r.loadConfig(t);r.existContainers(l,`/${l.base_name}$`)||r.Error("dockerコンテナが起動していません: "+docker.run.base_name);let i=[];try{if(!(l.log.tail&&l.log.tail[0]&&l.log.tail[0].length))throw new Error("ログ設定が正しくありません。");l.log.tail.length>1&&i.push("-s","2");var a=!0,s=!1,n=void 0;try{for(var c,h=l.log.tail[Symbol.iterator]();!(a=(c=h.next()).done);a=!0){let r=c.value,e=!0;var u=!0,g=!1,p=void 0;try{for(var y,f=r[Symbol.iterator]();!(u=(y=f.next()).done);u=!0){let r=y.value;if("object"==typeof r&&Array.isArray(r))i.push("-ci",r[1]),e||i.push("-I"),i.push(r[0]);else{if("string"!=typeof r)throw new Error("ログ設定が正しくない可能性があります。（指定できるのは文字列か配列のみです）"+r);e||i.push("-I"),i.push(r)}e=!1}}catch(r){g=!0,p=r}finally{try{!u&&f.return&&f.return()}finally{if(g)throw p}}}}catch(r){s=!0,n=r}finally{try{!a&&h.return&&h.return()}finally{if(s)throw n}}}catch(e){r.Error(e)}o.spawnSync("docker",["exec","-it",l.base_name,"multitail",...i],{stdio:"inherit"}),process.exit()});
},{"./libs.js":3}],33:[function(require,module,exports) {
"use strict";const e=require("./libs.js"),s=e.d,o=e.h,r=require("child_process"),t=require("inquirer"),i=require("cli-color");module.exports=(s=>{let o=s.usage("Usage: genie|g test [Options] [test paths/files]").options("mode",{alias:"M",default:"test",describe:"実行モードを指定可能（test時はデフォルト`test`）"}).options("open",{alias:"o",describe:"dockerホスト側のChromeブラウザで自動テストを実行する"}).argv;o.help&&(console.log(),e.Message(s.help(),"primary",1),process.exit()),process.env.GENIE_RUNMODE=o.mode,e.showRunmode(),o.mode=o.m="test";e.loadConfig(o);process.exit()});
},{"./libs.js":3}],1:[function(require,module,exports) {
"use strict";const e=require("./libs.js"),s=require("optimist");let n=s.usage("Usage: genie|g [Commands] [Options]").options("mode",{alias:"M",default:"develop",describe:"実行モードを指定可能"}).options("config",{alias:"C",default:"config.js",describe:"設定ファイルを指定可能"}).options("help",{alias:"h",describe:"説明表示"}).argv;process.env.GENIE_RUNMODE=n.mode;let r=n._.shift();"demo"===r?require("./cmd-demo.js")(s):"config"===r?require("./cmd-config.js")(s):"ls"===r?require("./cmd-ls.js")(s):"up"===r?require("./cmd-up.js")(s):"down"===r?require("./cmd-down.js")(s):"cli"===r?require("./cmd-cli.js")(s):"reject"===r?require("./cmd-reject.js")(s):"clean"===r?require("./cmd-clean.js")(s):"build"===r?require("./cmd-build.js")(s):"langver"===r?require("./cmd-langver.js")(s):"mysql"===r?require("./cmd-mysql.js")(s):"psql"===r?require("./cmd-psql.js")(s):"open"===r?require("./cmd-open.js")(s):"logs"===r?require("./cmd-logs.js")(s):"test"===r?require("./cmd-test.js")(s):(console.log(),e.Message(s.help()+"\nCommands:\n  init      \n  config    設定を確認する\n  ls        Dockerコンテナ状況を確認する\n  up        設定に基づきDockerコンテナを起動する\n  down      関連するコンテナのみ終了する\n  update    \n  cli       コンテナ内でコマンドを実行。またはコンテナに入る\n  reject    genie対象外のコンテナまたはボリュームを一括削除する\n  clean     不要なイメージ・終了済みコンテナ・リンクされてないボリュームを一括削除する\n  build     基本のdockerイメージをビルドする\n  langver   各種言語の利用可能なバージョンを確認する\n  mysql     MySQLを操作する\n  psql      PostgreSQLを操作する\n  open      ブラウザで開く\n  ngrok     \n  logs      実行ログを見る\n  dlsync    \n  httpd     \n  test      \n  demo      デモ\n","warning",1),process.exit());
},{"./libs.js":3,"./cmd-demo.js":5,"./cmd-config.js":7,"./cmd-ls.js":9,"./cmd-up.js":11,"./cmd-down.js":13,"./cmd-cli.js":15,"./cmd-reject.js":17,"./cmd-clean.js":19,"./cmd-build.js":21,"./cmd-langver.js":23,"./cmd-mysql.js":25,"./cmd-psql.js":27,"./cmd-open.js":29,"./cmd-logs.js":31,"./cmd-test.js":33}]},{},[1])