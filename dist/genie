#!/usr/bin/env node
parcelRequire=function(e,r,n){var t="function"==typeof parcelRequire&&parcelRequire,i="function"==typeof require&&require;function u(n,o){if(!r[n]){if(!e[n]){var f="function"==typeof parcelRequire&&parcelRequire;if(!o&&f)return f(n,!0);if(t)return t(n,!0);if(i&&"string"==typeof n)return i(n);var c=new Error("Cannot find module '"+n+"'");throw c.code="MODULE_NOT_FOUND",c}a.resolve=function(r){return e[n][1][r]||r};var l=r[n]=new u.Module(n);e[n][0].call(l.exports,a,l,l.exports)}return r[n].exports;function a(e){return u(a.resolve(e))}}u.isParcelRequire=!0,u.Module=function(e){this.id=e,this.bundle=u,this.exports={}},u.modules=e,u.cache=r,u.parent=t;for(var o=0;o<n.length;o++)u(n[o]);return u}({25:[function(require,module,exports) {
"use strict";function e(e){return function(){var r=e.apply(this,arguments);return new Promise(function(e,t){return function o(s,n){try{var p=r[s](n),l=p.value}catch(e){return void t(e)}if(!p.done)return Promise.resolve(l).then(function(e){o("next",e)},function(e){o("throw",e)});e(l)}("next")})}}const r=require("fs"),t=require("string-width"),o=require("cli-color"),s=require("jp-wrap")(o.windowSize.width-8),n=require("readline").createInterface(process.stdin,process.stdout),p=require("child_process"),l=require("path"),i=require("util"),c=module.exports.d=(e=>console.log(i.inspect(e,{colors:!0,compact:!1,breakLength:10,depth:10}))),a=module.exports.h=((e,r=o.white)=>console.log("\n  "+r(e))),h=module.exports.getProjectRootDir=(()=>{let e="",t=__dirname,o=!0;do{try{r.accessSync(t+"/.genie"),e=t}catch(e){t===(t=l.dirname(t))&&(o=!1)}}while(""===e&&o);if(e)return e;S("先祖ディレクトリに .genie/ が見つかりませんでした。\n`genie init` などして初期化してください。")}),u=module.exports.Repeat=((e,r=1)=>{if(!r>0)return"";let t="";for(let o=0;o<r;o++)t+=e;return t}),d=module.exports.Message=((e,r="default",n=0)=>{let p=o.white,l=o.white;"primary"===r?(p=o.xterm(26),l=o.xterm(39)):"success"===r?(p=o.green,l=o.greenBright):"danger"===r?(p=o.red,l=o.redBright):"warning"===r?(p=o.yellow,l=o.yellowBright):"info"===r?(p=o.whiteBright,l=o.whiteBright):"whisper"===r&&(p=o.blackBright,l=o.blackBright);let i=(e=s(e.replace(/[\r\n]+$/,""))).split(/[\r\n]+/),c=0;for(let e in i){let r=t(i[e]);c<r&&(c=r)}c+=2,console.log("  "+p("┏")+p(u("─",c))+p("┓"));for(let e in i)n>0&&n==e&&console.log("  "+p("┣")+p(u("─",c))+p("┫")),console.log("  "+p("│")+l(" "+i[e]+" ")+u(" ",c-2-t(i[e]))+p("│"));console.log("  "+p("┗")+p(u("─",c))+p("┛"))}),g=module.exports.Messages=(e=>{Array.isArray(e)||(e=[e]);for(let r in e)for(let t in e[r])d(e[r][t],t)}),m=module.exports.Input=((e,r=20)=>{let s=o.bgBlack("  "),p=t(e="  "+e+"  ")+r,l=o.whiteBright.bgBlueBright,i=o.bgBlue;return console.log("\n"+s+l(u(" ",p))+"\n"+s+l(e+u(" ",r))+"\n"+s+l(u(" ",p))+"\n"+s+i(u(" ",p))),process.stdout.write(o.move.up(3)),process.stdout.write(o.move.right(p-r)),new Promise(e=>{n.on("line",r=>{process.stdout.write(o.move.down(3)),e(r)})})}),_=module.exports.Say=(e=>{if(0!==e.length)if(w())p.execSync(`say -r 300 "${e}"`);else if($()){let t=r.mkdtempSync(process.env.TEMP+"/genie-say-"),o=t+"/say.js";r.writeFileSync(o,"var args = [];for(var i = 0; i < WScript.Arguments.length; i++) args.push(WScript.Arguments.Item(i));WScript.CreateObject('SAPI.SpVoice').Speak('<volume level=\"100\">'+'<rate speed=\"2\">'+'<pitch middle=\"0\">'+args.join(' ')+'</pitch>'+'</rate>'+'</volume>', 8);"),p.execSync(`start wscript ${o} "${e}"`),r.unlinkSync(o),r.rmdirSync(t)}}),k=module.exports.loadConfig=(e=>{let t=`${h()}/.genie/${e.config}`;try{r.accessSync(t)}catch(r){S(`設定ファイル（.genie/${e.config}）が見つかりませんでした。`)}let o=require(t).config;if(o.runmode=e.mode,o.run={},o.run.base_name=e.shadow?o.core.docker.name+"-SHADOW":o.core.docker.name,o.run.project_dir=h(),e.shadow&&(o.run.shadow=1),!o.core.docker.machine&&process.env.DOCKER_MACHINE_NAME&&(o.core.docker.machine=process.env.DOCKER_MACHINE_NAME),o.core.docker.ip_force)o.run.host_ip=o.core.docker.ip_force;else if(y()&&o.core.docker.machine){let e=p.spawnSync(`docker-machine ip ${o.core.docker.machine}`);e.status&&S(e.stderr.toString()),o.run.host_ip=e.stdout.trim()}else o.run.host_ip="localhost";return o}),$=module.exports.isWindows=(()=>"win32"===process.platform),w=module.exports.isMac=(()=>"darwin"===process.platform),y=module.exports.hasDockerMachineEnv=(()=>{return 0===p.spawnSync("docker-machine").status}),S=module.exports.Error=(e=>{console.log(),d(`エラーが発生しました。\n${e}`,"danger",1),_("エラーが発生しました"),process.exit()}),f=module.exports.dockerDown=((r,t)=>new Promise((s,n)=>{let l=x(t,r),i=[];for(let e=0;e<l.length;e++)i.push(new Promise((r,t)=>{process.stdout.write(o.blackBright(`  ${l[e].name} (${l[e].id}) ...`));let s=p.spawnSync("docker",["rm","-f",l[e].id]);s.stderr.toString()?(process.stdout.write(o.red(" delete NG!\n")),t(s.stderr.toString())):(process.stdout.write(o.green(" deleted.\n")),r())}));e(function*(){yield Promise.all(i).catch(function(e){return e})})(),s()})),b=module.exports.dockerUp=((e,r)=>"mysql"===e?new Promise((e,t)=>{try{let o=Object.keys(r.db.mysql);for(let s=0;s<o.length;s++){let n=r.db.mysql[o[s]],l=[];l.push("run","-d","-it"),l.push("-e","TERM=xterm"),l.push("--name",`${r.run.base_name}-mysql-${o[s]}`),l.push("--label",`genie_project_dir="${r.run.project_dir}"`),r.run.shadow&&l.push("--label","genie_shadow"),l.push("-v",`${r.run.project_dir}/.genie/files/opt/mysql/:/opt/mysql/`),l.push("-v",`${n.volume_lock?"locked_":""}${r.run.base_name}-mysql-${o[s]}:/var/lib/mysql`),l.push("-e",`MYSQL_LABEL=${o[s]}`),l.push("-e",`MYSQL_ROOT_PASSWORD=${n.pass}`),l.push("-e",`MYSQL_DATABASE=${n.name}`),l.push("-e",`MYSQL_USER=${n.user}`),l.push("-e",`MYSQL_PASSWORD=${n.pass}`),l.push("-e",`MYSQL_CHARSET=${n.charset}`),r.core.docker.network&&l.push(`--net=${r.core.docker.network}`),r.core.docker.options&&l.push(`${r.core.docker.options}`),n.external_port&&l.push("-p",`${n.external_port}:3306`),l.push("--entrypoint=/opt/mysql/before-entrypoint.sh"),l.push("--restart=always"),l.push(n.repository),l.push("mysqld"),n.charset&&l.push(`--character-set-server=${n.charset}`),n.collation&&l.push(`--collation-server=${n.collation}`);let i=p.spawnSync("docker",l);i.stderr.toString()?t(i.stderr.toString()):e()}e()}catch(e){t(e)}}):"postgresql"===e?new Promise((e,t)=>{try{let o=Object.keys(r.db.postgresql);for(let s=0;s<o.length;s++){let n=r.db.postgresql[o[s]],l=[];l.push("run","-d","-it"),l.push("-e","TERM=xterm"),l.push("--name",`${r.run.base_name}-postgresql-${o[s]}`),l.push("--label",`genie_project_dir="${r.run.project_dir}"`),r.run.shadow&&l.push("--label","genie_shadow"),l.push("-v",`${r.run.project_dir}/.genie/files/opt/postgresql/:/opt/postgresql/`),l.push("-v",`${n.volume_lock?"locked_":""}${r.run.base_name}-postgresql-${o[s]}:/var/lib/postgresql`),l.push("-e",`POSTGRES_LABEL=${o[s]}`),l.push("-e",`POSTGRES_HOST=${n.host}`),l.push("-e",`POSTGRES_DB=${n.name}`),l.push("-e",`POSTGRES_USER=${n.user}`),l.push("-e",`POSTGRES_PASSWORD=${n.pass}`),l.push("-e",`POSTGERS_ENCODING=${n.encoding}`),l.push("-e",`POSTGERS_LOCALE=${n.locale}`),r.core.docker.network&&l.push(`--net=${r.core.docker.network}`),r.core.docker.options&&l.push(`${r.core.docker.options}`),n.external_port&&l.push("-p",`${n.external_port}:5432`),l.push("--entrypoint=/opt/postgresql/before-entrypoint.sh"),l.push("--restart=always"),l.push(n.repository),l.push("postgres");let i=p.spawnSync("docker",l);i.stderr.toString()?t(i.stderr.toString()):e()}e()}catch(e){t(e)}}):"genie"===e?new Promise((e,t)=>{let o=[];if(o.push("run","-d","-it"),o.push("-e","TERM=xterm"),o.push("-e","LANG=ja_JP.UTF-8"),o.push("-e","LC_ALL=ja_JP.UTF-8"),o.push("-v",r.run.project_dir+"/.genie/files/opt:/opt"),o.push("--label",`genie_project_dir="${r.run.project_dir}"`),r.run.shadow&&o.push("--label","genie_shadow"),o.push(`--name=${r.run.base_name}`),r.core.docker.network&&o.push(`--net=${r.core.docker.network}`),r.core.docker.options&&o.push(`${r.core.docker.options}`),o.push("--restart=always"),r.lang.perl.cpanfile_enabled&&o.push("-e","PERL5LIB=/perl/cpanfile-modules/lib/perl5"),r.db.postgresql){let e=Object.keys(r.db.postgresql);for(let t=0;t<e.length;t++){let s=`${r.run.base_name}-postgresql-${e[t]}`;o.push("--link",s),o.push("--add-host",r.db.postgresql[e[t]].host+":"+v(s,r))}}if(r.db.mysql){let e=Object.keys(r.db.mysql);for(let t=0;t<e.length;t++){let s=`${r.run.base_name}-mysql-${e[t]}`;o.push("--link",s),o.push("--add-host",r.db.mysql[e[t]].host+":"+v(s,r))}}if(r.trans.sshd&&o.push("-p",`${r.trans.sshd.external_port}:22`),r.http.apache&&(o.push("-v",`${r.run.project_dir}/${r.http.apache.public_dir}:/var/www/html`),r.http.apache.external_http_port&&o.push("-p",`${r.http.apache.external_http_port}:80`),r.http.apache.external_https_port&&o.push("-p",`${r.http.apache.external_https_port}:443`)),r.http.nginx&&(o.push("-v",`${r.run.project_dir}/${r.http.nginx.public_dir}:/usr/share/nginx/html`),r.http.nginx.external_http_port&&o.push("-p",`${r.http.nginx.external_http_port}:80`),r.http.nginx.external_https_port&&o.push("-p",`${r.http.nginx.external_https_port}:443`)),r.mail.sendlog.external_port&&o.push("-p",`${r.mail.sendlog.external_port}:9981`),r.log.fluentd&&o.push("-v",`${r.run.project_dir}/.genie/files/opt/td-agent:/etc/td-agent`),r.core.docker.hosts&&Array.isArray(r.core.docker.hosts)&&r.core.docker.hosts.length)for(let e=0;e<r.core.docker.hosts.length;e++)o.push(`--add-host=${r.core.docker.hosts[e]}`);if(o.push("-v",`${r.run.project_dir}/:/mnt/host/`),r.core.docker.volumes&&Array.isArray(r.core.docker.volumes)&&r.core.docker.volumes.length)for(let e=0;e<r.core.docker.volumes.length;e++)r.core.docker.volumes[e].match(/^\//)?o.push("-v",`${r.core.docker.volumes[e]}`):o.push("-v",`${r.run.project_dir}/${r.core.docker.volumes[e]}`);let s={},n=(e,r)=>{if("object"!=typeof e||Array.isArray(e))"object"==typeof e&&Array.isArray(e)?s[r]=JSON.stringify(e):s[r]=e;else{let t=Object.keys(e);for(let o=0;o<t.length;o++)n(e[t[o]],`${r}_${t[o].toUpperCase()}`)}};n(r,"GENIE"),s.GENIE_RUNMODE=r.runmode;let l=Object.keys(s);for(let e=0;e<l.length;e++)o.push("-e",`${l[e]}=${s[l[e]]}`);o.push(r.core.docker.image),c(o.join(" "));let i=p.spawnSync("docker",o);i.stderr.toString()?t(i.stderr.toString()):e()}):void 0),x=module.exports.existContainers=((e,r)=>{let t=["--filter",`label=genie_project_dir="${e.run.project_dir}"`];e.run.shadow&&t.push("--filter","label=genie_shadow"),r&&t.push("--filter",`name=${r}`);let o=p.spawnSync("docker",["ps","-a","--format","{{.ID}}\t{{.Names}}",...t]).stdout.toString().split(/\n/),s=[];for(let e=0;e<o.length;e++){let r=o[e].split(/\s+/);r[0]&&s.push({id:r[0],name:r[1]})}return!!s.length&&s}),v=module.exports.getContainerIp=((e,r)=>{try{let t;if(!(t=r.core.docker.network?p.spawnSync("docker",["inspect",`--format={{.NetworkSettings.Networks.${r.core.docker.network}.IPAddress}}`,e]):p.spawnSync("docker",["inspect","--format={{.NetworkSettings.IPAddress}}",e])).stderr.toString())return t.stdout.toString().replace(/[\r\n]$/,"");S(t.stderr.toString())}catch(e){S(e)}});
},{}],3:[function(require,module,exports) {
"use strict";function e(e){return function(){var n=e.apply(this,arguments);return new Promise(function(e,t){return function s(r,o){try{var a=n[r](o),i=a.value}catch(e){return void t(e)}if(!a.done)return Promise.resolve(i).then(function(e){s("next",e)},function(e){s("throw",e)});e(i)}("next")})}}const n=require("./libs.js"),t=n.d,s=n.h;module.exports=(()=>{var t=e(function*(e){console.log(),n.Message("サンプル：default","default"),n.Message("サンプル：primary","primary"),n.Message("サンプル：success","success"),n.Message("サンプル：danger","danger"),n.Message("サンプル：warning","warning"),n.Message("サンプル：info","info"),n.Message("改行込み、1ライン入れも可能。\ntest1\ntest2\ntest3","default",1);let t=yield n.Input("入力BOX（入力文字を発音しますのでご注意）：",20);n.Message("入力された文字："+t),n.Say(t);try{throw new Error("エラーテスト（終了コード255）")}catch(e){console.log(e),process.exit(255)}process.exit()});return function(e){return t.apply(this,arguments)}})();
},{"./libs.js":25}],5:[function(require,module,exports) {
"use strict";const e=require("./libs.js"),s=e.d,i=e.h,o=require("child_process");module.exports=(i=>{let c=i.usage("Usage: genie|g config [Options]").options("dump",{alias:"d",describe:"設定値を確認します。"}).argv;c.help&&(console.log(),e.Message(i.help(),"primary",1),process.exit());let r=e.loadConfig(c);if(c.dump)s(r);else{let s=`${e.getProjectRootDir()}/.genie/${c.config}`;e.isWindows()?o.execSync(`start ${s}`):e.isMac()&&o.execSync(`open ${s}`)}process.exit()});
},{"./libs.js":25}],7:[function(require,module,exports) {
"use strict";const t=require("./libs.js"),e=t.d,s=t.h,r=require("child_process"),o=require("cli-color"),i=require("cliui")({width:o.windowSize.width-4});module.exports=(e=>{let s=e.usage("Usage: genie|g ls [Options]").options("long",{alias:"l",describe:"コンテナ一覧がもうちょっとだけ詳細に出ます"}).argv;if(s.help&&(console.log(),t.Message(e.help(),"primary",1),process.exit()),t.hasDockerMachineEnv()){console.log("\n  DockeMachines");let e=r.spawnSync("docker-machine",["ls"]);e.status&&t.Error(e.stderr.toString()),t.Message(e.stdout.toString(),"primary",1)}{console.log("\n  Images");let e=r.spawnSync("docker",["images"]);e.status&&t.Error(e.stderr.toString()),t.Message(e.stdout.toString(),"primary",1)}{console.log("\n  Volumes");let e=r.spawnSync("docker",["volume","ls","--format","table {{.Name}}\t{{.Driver}}\t{{.Scope}}\t{{.Mountpoint}}"]);e.status&&t.Error(e.stderr.toString()),t.Message(e.stdout.toString(),"primary",1)}{console.log("\n  Containers");let e=["--format","{{.Names}}\t{{.ID}}\t{{.Image}}\t{{.Status}}\t{{.Ports}}"],o=["NAMES","ID","IMAGE","STATUS","PORTS"];s.long&&(e=["--format","{{.Names}}\t{{.ID}}\t{{.Image}}\t{{.Command}}\t{{.CreatedAt}}\t{{.Status}}\t{{.Ports}}\t{{.Labels}}"],o=["NAMES","ID","IMAGE","COMMAND","CREATED","STATUS","PORTS","LABELS"]);let n=r.spawnSync("docker",["ps","-a",...e]);n.status&&t.Error(n.stderr.toString());let a=n.stdout.toString().trim().split("\n");a.unshift(o.join("\t"));for(let t in a){let e=a[t].split(/\t/),r=[];for(let t in e){let o;s.long?(6==t&&(o=30),7==t&&(o=50)):4==t&&(o=30),r.push({text:e[t].replace(/, ?/g,"\n"),width:o,padding:[0,1,0,1]})}i.div(...r)}t.Message(i.toString(),"primary",1)}process.exit()});
},{"./libs.js":25}],9:[function(require,module,exports) {
"use strict";function e(e){return function(){var r=e.apply(this,arguments);return new Promise(function(e,o){return function n(t,s){try{var c=r[t](s),i=c.value}catch(e){return void o(e)}if(!c.done)return Promise.resolve(i).then(function(e){n("next",e)},function(e){n("throw",e)});e(i)}("next")})}}const r=require("./libs.js"),o=r.d,n=r.h,t=require("child_process");module.exports=(o=>{let t=o.usage("Usage: genie|g up [Options]").options("shadow",{alias:"s",describe:"データをマウントではなくコンテナにコピーした別のコンテナを起動する"}).argv;t.help&&(console.log(),r.Message(o.help(),"primary",1),process.exit());let s=r.loadConfig(t);try{let e=s.core.memo.up;e&&r.Messages(e)}catch(e){Error("メモの設定が異常です。")}e(function*(){r.existContainers(s)&&(yield Promise.all([r.dockerDown("/"+s.run.base_name+"-postgresql",s),r.dockerDown("/"+s.run.base_name+"-mysql",s),r.dockerDown("/"+s.run.base_name+"$",s),r.dockerDown(null,s)]).catch(function(e){return e}));let e=[];try{Object.keys(s.db.postgresql).length&&e.push(r.dockerUp("postgresql",s))}catch(e){Error(e)}try{Object.keys(s.db.mysql).length&&e.push(r.dockerUp("mysql",s))}catch(e){Error(e)}yield Promise.all(e).catch(function(e){r.Error(e)}),yield r.dockerUp("genie",s).catch(function(e){return r.Error(e)}),n("起動完了!!"),process.exit()})()});
},{"./libs.js":25}],11:[function(require,module,exports) {
"use strict";function e(e){return function(){var n=e.apply(this,arguments);return new Promise(function(e,r){return function o(s,t){try{var i=n[s](t),c=i.value}catch(e){return void r(e)}if(!i.done)return Promise.resolve(c).then(function(e){o("next",e)},function(e){o("throw",e)});e(c)}("next")})}}const n=require("./libs.js"),r=n.d,o=n.h,s=require("child_process");module.exports=(r=>{let s=r.usage("Usage: genie|g down [Options]").options("shadow",{alias:"s",describe:"データをマウントではなくコンテナにコピーした別のコンテナを終了する"}).argv;s.help&&(console.log(),n.Message(r.help(),"primary",1),process.exit());let t=n.loadConfig(s);try{let e=t.core.memo.down;e&&n.Messages(e)}catch(e){Error("メモの設定が異常です。")}e(function*(){n.existContainers(t)&&(yield Promise.all([n.dockerDown("/"+t.run.base_name+"-postgresql",t),n.dockerDown("/"+t.run.base_name+"-mysql",t),n.dockerDown("/"+t.run.base_name+"$",t),n.dockerDown(null,t)]).catch(function(e){return e})),o("DONE!"),process.exit()})()});
},{"./libs.js":25}],13:[function(require,module,exports) {
"use strict";const e=require("./libs.js"),s=e.d,o=e.h,r=require("child_process");module.exports=(s=>{let o=s.usage("Usage: genie|g cli [Options] [Commands]").options("host",{describe:"実行するホスト名を指定する"}).argv;o.help&&(console.log(),e.Message(s.help(),"primary",1),process.exit());let t=e.loadConfig(o),i=o.host?o.host:t.core.docker.name,c=process.argv.slice(process.argv.findIndex(e=>e===o._[1]));if(e.existContainers(t,"/"+i+"$")||e.Error("dockerコンテナが起動していません: "+i),1!==o._.length){let s=r.spawnSync("docker",["exec",i,...c]);s.status&&(e.Error(s.stderr.toString()||s.stdout.toString()),process.exit()),console.log(s.stdout.toString()),process.exit()}else r.spawnSync("docker",["exec","-it",i,"bash"],{stdio:"inherit"}),process.exit()});
},{"./libs.js":25}],15:[function(require,module,exports) {
"use strict";const e=require("./libs.js"),t=e.d,r=e.h,o=require("child_process"),s=require("inquirer"),i=require("cli-color");module.exports=(t=>{let l=t.usage("Usage: genie|g reject [Options]").options("force",{alias:"f",describe:"lockedから始まる名前も対象にする"}).argv;l.help&&(console.log(),e.Message(t.help(),"primary",1),process.exit());let n=[],a=o.spawnSync("docker",["ps","-qa","--format","{{.Names}}\t{{.Status}}"]);a.status&&e.Error(a.stderr.toString());var c=!0,u=!1,d=void 0;try{for(var p,m=a.stdout.toString().trim().split(/\n/)[Symbol.iterator]();!(c=(p=m.next()).done);c=!0){let e=p.value;if(!e)continue;let t=e.split(/\t/),r=t[0],o=(t[1],r.match(/^locked_/)),s=`[Container] ${r}`;o&&(s=i.blackBright(s)),n.push({name:s,checked:!(o&&!l.f)})}}catch(e){u=!0,d=e}finally{try{!c&&m.return&&m.return()}finally{if(u)throw d}}let f=[];(a=o.spawnSync("docker",["volume","ls","--format","{{.Name}}\t{{.Driver}}"])).status&&e.Error(a.stderr.toString());var h=!0,g=!1,y=void 0;try{for(var v,w=a.stdout.toString().trim().split(/\n/)[Symbol.iterator]();!(h=(v=w.next()).done);h=!0){let e=v.value;if(!e)continue;let t=e.split(/\t/),r=t[0],o=(t[1],r.match(/^locked_/)),s=`[Volume] ${r}`;o&&(s=i.blackBright(s)),f.push({name:s,checked:!(o&&!l.f)})}}catch(e){g=!0,y=e}finally{try{!h&&w.return&&w.return()}finally{if(g)throw y}}let S=n.length+f.length;0===S&&(r("対象のオブジェクトはありませんでした。"),process.exit()),console.log(),s.prompt([{type:"checkbox",message:"削除したいものにチェックを入れて Enter してください。",name:"rejects",pageSize:100,choices:[...n,...f]}]).then(t=>{process.stdout.write(i.move.up(S));for(let e=0;e<S;e++)process.stdout.write(i.erase.line),process.stdout.write(i.move.down(1));process.stdout.write(i.move.up(S-1));var r=!0,s=!1,l=void 0;try{for(var n,a=t.rejects[Symbol.iterator]();!(r=(n=a.next()).done);r=!0){let t=n.value,r=(t=i.strip(t)).match(/^\[(Container|Volume)\] (.+)$/);if("Container"===r[1]){let t=r[2];process.stdout.write(`  [Container] ${t} - `);let s=o.spawnSync("docker",["rm","-f",t]);s.status&&e.Error(s.stderr.toString()),process.stdout.write(i.green("deleted\n"))}else if("Volume"===r[1]){let t=r[2];process.stdout.write(`  [Volume] ${t} - `);let s=o.spawnSync("docker",["volume","rm","-f",t]);s.status&&e.Error(s.stderr.toString()),process.stdout.write(i.green("deleted\n"))}}}catch(e){s=!0,l=e}finally{try{!r&&a.return&&a.return()}finally{if(s)throw l}}})});
},{"./libs.js":25}],17:[function(require,module,exports) {
"use strict";const t=require("./libs.js"),r=t.d,e=t.h,o=require("child_process"),s=require("cli-color");module.exports=(r=>{let n,i,l=r.usage("Usage: genie|g clean [Options]").options("force",{alias:"f",describe:"lockedから始まる名前も対象にする"}).argv;l.help&&(console.log(),t.Message(r.help(),"primary",1),process.exit());let a=0;n=["ps","-qa","--filter","exited=0","--format","{{.Names}}"],(i=o.spawnSync("docker",n)).status&&t.Error(i.stderr.toString());var c=!0,d=!1,u=void 0;try{for(var f,g=i.stdout.toString().trim().split(/\n/)[Symbol.iterator]();!(c=(f=g.next()).done);c=!0){let r=f.value;if(!r)continue;if(!l.f&&r.match(/^locked_/i))continue;a++||console.log(),process.stdout.write(`  [Container] ${r} - `);let e=o.spawnSync("docker",["rm","-fv",r]);e.status&&t.Error(e.stderr.toString()),process.stdout.write(s.green("deleted\n"))}}catch(t){d=!0,u=t}finally{try{!c&&g.return&&g.return()}finally{if(d)throw u}}n=["volume","ls","--filter","dangling=true","--format","{{.Name}}"],(i=o.spawnSync("docker",n)).status&&t.Error(i.stderr.toString());var p=!0,m=!1,y=void 0;try{for(var S,v=i.stdout.toString().trim().split(/\n/)[Symbol.iterator]();!(p=(S=v.next()).done);p=!0){let r=S.value;if(!r)continue;if(!l.f&&r.match(/^locked_/i))continue;a++||console.log(),process.stdout.write(`  [Volume] ${r} - `);let e=o.spawnSync("docker",["volume","rm","-f",r]);e.status&&t.Error(e.stderr.toString()),process.stdout.write(s.green("deleted\n"))}}catch(t){m=!0,y=t}finally{try{!p&&v.return&&v.return()}finally{if(m)throw y}}n=["images","-q","--filter","dangling=true"],(i=o.spawnSync("docker",n)).status&&t.Error(i.stderr.toString());var w=!0,h=!1,k=void 0;try{for(var x,E=i.stdout.toString().trim().split(/\n/)[Symbol.iterator]();!(w=(x=E.next()).done);w=!0){let r=x.value;if(!r)continue;a++||console.log(),process.stdout.write(`  [Image] ${r} - `);let e=o.spawnSync("docker",["rmi",r]);e.status&&t.Error(e.stderr.toString()),process.stdout.write(s.green("deleted\n"))}}catch(t){h=!0,k=t}finally{try{!w&&E.return&&E.return()}finally{if(h)throw k}}a||e("対象のオブジェクトはありませんでした。"),process.exit()});
},{"./libs.js":25}],19:[function(require,module,exports) {
"use strict";function e(e){return function(){var o=e.apply(this,arguments);return new Promise(function(e,n){return function t(r,i){try{var c=o[r](i),s=c.value}catch(e){return void n(e)}if(!c.done)return Promise.resolve(s).then(function(e){t("next",e)},function(e){t("throw",e)});e(s)}("next")})}}const o=require("./libs.js"),n=o.d,t=o.h,r=require("child_process");module.exports=(n=>{let t=n.usage("Usage: genie|g build [Options]").options("no-cache",{alias:"n",describe:"キャッシュを使用せずにビルドする"}).argv;t.help&&(console.log(),o.Message(n.help(),"primary",1),process.exit());let i=o.loadConfig(t);e(function*(){if((yield o.Input(`${i.core.docker.image} イメージをビルドしてもよろしいでしょうか。[y/N]: `)).match(/^y$/i)){let e=["build","-t",i.core.docker.image];t["no-cache"]&&e.push("--no-cache"),e.push(`${o.getProjectRootDir()}/.genie/image/`),o.Message(`ビルドを開始します。\ndocker ${e.join(" ")}`,"info"),console.log();let n=r.spawn("docker",e);n.stdout.on("data",function(e){console.log(color.blackBright(e.toString().trim()))}),n.stderr.on("data",function(e){o.Error(e),process.exit()}),n.on("close",function(e){let n="ビルドが完了しました。";o.Message(n),o.Say(n),process.exit()})}process.exit()})()});
},{"./libs.js":25}],21:[function(require,module,exports) {
"use strict";const e=require("./libs.js"),n=e.d,i=e.h,s=require("child_process");module.exports=(n=>{let i=n.usage("Usage: genie|g langver [Options]").options("php",{describe:"PHPの利用可能なバージョン一覧を表示"}).options("perl",{describe:"Perlの利用可能なバージョン一覧を表示"}).options("ruby",{describe:"Rubyの利用可能なバージョン一覧を表示"}).options("node",{describe:"Node.jsの利用可能なバージョン一覧を表示"}).argv;if(i.help&&(console.log(),e.Message(n.help(),"primary",1),process.exit()),i.php){let n=s.spawnSync("docker",["run","--rm","--entrypoint=bash","kazaoki/genie","-c","/root/.anyenv/envs/phpenv/plugins/php-build/bin/php-build --definitions"]);e.Message(n.stdout.toString(),"primary")}else if(i.perl){let n=s.spawnSync("docker",["run","--rm","--entrypoint=bash","kazaoki/genie","-c","/root/.anyenv/envs/plenv/plugins/perl-build/perl-build  --definitions"]);e.Message(n.stdout.toString(),"primary")}else if(i.ruby){let n=s.spawnSync("docker",["run","--rm","--entrypoint=bash","kazaoki/genie","-c","/root/.anyenv/envs/rbenv/plugins/ruby-build/bin/ruby-build  --definitions"]);e.Message(n.stdout.toString(),"primary")}else if(i.node){let n=s.spawnSync("docker",["run","--rm","--entrypoint=bash","kazaoki/genie","-c","/root/.anyenv/envs/ndenv/plugins/node-build/bin/node-build  --definitions"]);e.Message(n.stdout.toString(),"primary")}else console.log(),e.Message(n.help(),"primary",1);process.exit()});
},{"./libs.js":25}],23:[function(require,module,exports) {
"use strict";const r=require("./libs.js"),e=r.d,t=r.h,o=require("child_process"),s=require("cli-color");module.exports=(t=>{let s=t.usage("Usage: genie|g open [Options]").argv;s.help&&(console.log(),r.Message(t.help(),"primary",1),process.exit());let a,p=r.loadConfig(s);a=r.isWindows?"start":r.isWindows?"open":"xdg-open";let i="",h="https"===p.http.browser.schema?443:80,n=o.spawnSync("docker",["port",p.run.base_name,h]);n.status&&Error(n.stderr.toString());let c=n.stdout.toString().trim().match(/(\d+)$/)[1];c="http"===p.http.browser.schema&&80==c||"https"===p.http.browser.schema&&443==c?"":`:${c}`;let l=`${p.http.browser.schema}://${p.run.host_ip}${c}${p.http.browser.path}`;p.http.browser.apps&&p.http.browser.apps.length||(p.http.browser.apps=[""]);var f=!0,d=!1,m=void 0;try{for(var w,$=p.http.browser.apps[Symbol.iterator]();!(f=(w=$.next()).done);f=!0){i=w.value;let t="";r.isWindows()?"chrome"===i?t=" chrome":"firefox"===i?t=" firefox":"ie"===i?t=" explorer":"opera"===i?t=" opera":i&&(t=` ${i}`):"chrome"===i?t=" -a chrome":"firefox"===i?t=" -a firefox":"safari"===i?t=" -a safari":"opera"===i?t=" -a opera":i&&(t=` -a ${i}`),e(`${a}${t} ${l}`),o.execSync(`${a}${t} ${l}`)}}catch(r){d=!0,m=r}finally{try{!f&&$.return&&$.return()}finally{if(d)throw m}}process.exit()});
},{"./libs.js":25}],1:[function(require,module,exports) {
"use strict";const e=require("optimist");let s=e.usage("Usage: genie|g [Commands] [Options]").options("mode",{alias:"m",default:"develop",describe:"実行モードを指定可能"}).options("config",{alias:"c",default:"config.js",describe:"設定ファイルを指定可能"}).options("help",{alias:"h",describe:"説明表示"}).argv;if("demo"===s._[0])require("./cmd-demo.js")(e);else if("config"===s._[0])require("./cmd-config.js")(e);else if("ls"===s._[0])require("./cmd-ls.js")(e);else if("up"===s._[0])require("./cmd-up.js")(e);else if("down"===s._[0])require("./cmd-down.js")(e);else if("cli"===s._[0])require("./cmd-cli.js")(e);else if("reject"===s._[0])require("./cmd-reject.js")(e);else if("clean"===s._[0])require("./cmd-clean.js")(e);else if("build"===s._[0])require("./cmd-build.js")(e);else if("langver"===s._[0])require("./cmd-langver.js")(e);else if("open"===s._[0])require("./cmd-open.js")(e);else{const s=require("./libs.js");console.log(),s.Message(e.help()+"\nCommands:\n  init      \n  config    設定を確認する\n  ls        Dockerコンテナ状況を確認する\n  up        設定に基づきDockerコンテナを起動する\n  down      関連するコンテナのみ終了する\n  update    \n  cli       コンテナ内でコマンドを実行。またはコンテナに入る\n  reject    genie対象外のコンテナまたはボリュームを一括削除する\n  clean     不要なイメージ・終了済みコンテナ・リンクされてないボリュームを一括削除する\n  build     基本のdockerイメージをビルドする\n  langver   各種言語の利用可能なバージョンを確認する\n  mysql     \n  psql      \n  open      ブラウザで開く\n  ngrok     \n  logs      \n  dlsync    \n  httpd     \n  demo      デモ\n","warning",1),process.exit()}
},{"./cmd-demo.js":3,"./cmd-config.js":5,"./cmd-ls.js":7,"./cmd-up.js":9,"./cmd-down.js":11,"./cmd-cli.js":13,"./cmd-reject.js":15,"./cmd-clean.js":17,"./cmd-build.js":19,"./cmd-langver.js":21,"./cmd-open.js":23,"./libs.js":25}]},{},[1])